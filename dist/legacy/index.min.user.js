// ==UserScript==
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     One configurer to setup them all
// @grant           GM_deleteValue
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           unsafeWindow
// @homepage        https://github.com/userscripters/userscripts-configurer#readme
// @match           https://*.stackexchange.com/*
// @match           https://askubuntu.com/*
// @match           https://es.meta.stackoverflow.com/*
// @match           https://es.stackoverflow.com/*
// @match           https://ja.meta.stackoverflow.com/*
// @match           https://ja.stackoverflow.com/*
// @match           https://mathoverflow.net/*
// @match           https://meta.askubuntu.com/*
// @match           https://meta.mathoverflow.net/*
// @match           https://meta.serverfault.com/*
// @match           https://meta.stackoverflow.com/*
// @match           https://meta.superuser.com/*
// @match           https://pt.meta.stackoverflow.com/*
// @match           https://pt.stackoverflow.com/*
// @match           https://ru.meta.stackoverflow.com/*
// @match           https://ru.stackoverflow.com/*
// @match           https://serverfault.com/*
// @match           https://stackapps.com/*
// @match           https://stackoverflow.com/*
// @match           https://superuser.com/*
// @name            Userscripts Configurer
// @namespace       userscripters
// @require         https://github.com/userscripters/storage/raw/master/dist/browser.js
// @run-at          document-start
// @source          git+https://github.com/userscripters/userscripts-configurer.git
// @supportURL      https://github.com/userscripters/userscripts-configurer/issues
// @version         0.1.0
// ==/UserScript==

"use strict";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),d=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)d.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return d},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};window.addEventListener("load",function(){var m,r,d,o,n,a,e,t,s,v="userscript-configurer",i=window.Store;function l(e,t){var n=a.call(this,e,t)||this;return n.name=e,n.storage=t,n.options=new Map,n}function c(e){this.storage=e,this.scripts=new Map}i?(m=function(e){return __spreadArray([],__read(e.children),!1).forEach(function(e){return e.remove()})},r=function(e,t){var n=(t=void 0===t?{}:t).classes,n=void 0===n?[]:n,r=t.description,r=void 0===r?"":r,a=t.parent,s=t.placeholder,s=void 0===s?"":s,d=t.title,d=void 0===d?"":d,t=t.value,t=void 0===t?"":t,o=document.createElement("div"),i=((i=o.classList).add.apply(i,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(n),!1)),document.createElement("div")),n=(i.classList.add("d-flex","ps-relative"),document.createElement("input"));return n.classList.add("s-input"),n.id=e,n.type="text",n.placeholder=s,n.value=t,i.append(n),o.append(i),d?((s=document.createElement("div")).classList.add("flex--item"),(t=document.createElement("label")).classList.add("d-block","s-label"),t.htmlFor=e,t.textContent=d,r&&((i=document.createElement("p")).classList.add("s-description","mt2"),i.textContent=r,t.append(i)),s.append(t),o.prepend(s),[o,n,t]):(null!=a&&a.append(o),[o,n])},d=function(e,t){var n=t.items,n=void 0===n?[]:n,t=t.classes,t=void 0===t?[]:t,r=document.createElement("fieldset"),a=((a=r.classList).add.apply(a,__spreadArray(["mt8"],__read(t),!1)),r.id=e,n.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.id,r=e.label,a=e.name,e=e.selected,e=void 0!==e&&e,s=document.createElement("div"),d=s.classList,d=(d.add("d-flex","gs8"),t&&d.add("is-disabled"),document.createElement("div")),o=(d.classList.add("flex--item"),document.createElement("input")),t=(o.classList.add("s-checkbox"),o.disabled=t,o.id=n||a,o.name=a,o.type="checkbox",o.checked=e,document.createElement("label"));return t.classList.add("flex--item","s-label","fw-normal"),t.htmlFor=n||a,t.textContent=r,d.append(o),s.append(d,t),s}));return r.append.apply(r,__spreadArray([],__read(a),!1)),[r]},o=function(e,t){var n,r=t.classes,r=void 0===r?[]:r,a=t.description,a=void 0===a?"":a,s=t.disabled,s=void 0!==s&&s,d=t.items,d=void 0===d?[]:d,t=t.title,t=void 0===t?"":t,o=document.createElement("div"),t=((n=o.classList).add.apply(n,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(r),!1)),t&&((n=document.createElement("label")).classList.add("d-block","s-label"),n.htmlFor=e,n.textContent=t,a&&((r=document.createElement("p")).classList.add("s-description","mt2"),r.textContent=a,n.append(r)),o.append(n)),document.createElement("div")),a=(t.classList.add("flex--item","s-select"),document.createElement("select")),r=(a.id=e,a.disabled=s,d.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.label,r=e.selected,r=void 0!==r&&r,e=e.value,e=void 0===e?"":e,a=document.createElement("option");return a.selected=r,a.value=e,a.textContent=n,a.disabled=t,a}));return a.append.apply(a,__spreadArray([],__read(r),!1)),t.append(a),o.append(t),[o,a]},a=null==i?void 0:i.default,__extends(l,a),l.prototype.option=function(e,t,n,r){return this.options.set(e,{name:e,desc:t,def:r,type:n}),this.render(),this},l.prototype.render=function(){var a=this.name,e=this.options,t=this.container||(this.container=document.createElement("div")),n=(t.classList.add("".concat(v,"-userscript"),"d-flex","fd-column","mb24"),document.createElement("h2")),s=(n.classList.add("mb8"),n.textContent=a,{text:r,select:o,checkbox:d}),e=__spreadArray([],__read(e),!1).map(function(e){var e=__read(e,2),t=e[0],e=e[1],n=e.desc,r=e.def,e=e.type;return __read(s[void 0===e?"text":e]("".concat(v,"-").concat(a,"-").concat(t),{items:[{label:n,name:t,selected:r}],description:n,title:t,value:r}),1)[0]});return m(t),t.append.apply(t,__spreadArray([n],__read(e),!1)),e.length||((n=document.createElement("div")).textContent="No configuration options available",t.append(n)),t},n=l,c.prototype.render=function(){var e,t,n,r,a,s,d,o,i,l,c={parent:document.body},p=["ps-fixed","r0"],u=__spreadArray([],__read(this.scripts),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()}),_=(this.controller||(this.controller=(o="".concat(v,"-modal-controller"),n="UserScripters",e=__assign(__assign({},c),{type:"outlined",muted:!0,classes:__spreadArray(__spreadArray([],__read(p),!1),["bar0","t128"],!1)}),t=void 0===(t=(e=void 0===e?{}:e).classes)?[]:t,i=e.title,r=void 0!==(r=e.danger)&&r,d=void 0!==(d=e.loading)&&d,a=void 0!==(a=e.muted)&&a,l=e.parent,s=void 0!==(s=e.primary)&&s,e=void 0===(e=e.type)?"filled":e,(_=document.createElement("button")).id=o,_.textContent=n,(o=_.classList).add.apply(o,__spreadArray(["s-btn","s-btn__".concat(e)],__read(t),!1)),_.setAttribute("role","button"),_.setAttribute("aria-label",i||n),o=_.classList,r&&o.add("s-btn__danger"),a&&o.add("s-btn__muted"),s&&o.add("s-btn__primary"),d&&o.add("is-loading"),i&&(_.title=i),null!=l&&l.append(_),_)),this.modal||(this.modal=(e="".concat(v,"-modal"),t=this.controller,n=__assign(__assign({},c),{classes:__spreadArray(__spreadArray([],__read(p),!1),["z-modal","".concat(v,"-modal")],!1),contentClasses:["ba","bar-lg","bc-black-075","bg-white","p16","wmn3"],expanded:!1}),r=void 0===(r=(n=void 0===n?{}:n).classes)?[]:r,a=void 0===(a=n.content)?[]:a,s=void 0===(s=n.contentClasses)?[]:s,d=n.controllerClasses,o=void 0!==(o=n.expanded)&&o,n=n.parent,i=document.createElement("div"),(l=i.classList).add.apply(l,__spreadArray(["s-expandable"],__read(r),!1)),i.id=e,o&&i.classList.add("is-expanded"),l=document.createElement("div"),(r=l.classList).add.apply(r,__spreadArray(["s-expandable--content"],__read(s),!1)),l.append.apply(l,__spreadArray([],__read(a),!1)),(r=t.dataset).controller="s-expandable-control",d&&(r.sExpandableControlToggleClass=d.join(" ")),t.setAttribute("aria-controls",e),t.setAttribute("aria-expanded",JSON.stringify(o)),i.append(l),null!=n&&n.append(i),i)),this.modal.querySelector(".s-expandable--content"));return _?(m(_),_.append.apply(_,__spreadArray([],__read(u),!1))):console.debug("[".concat(v,"] missing modal content element")),this},c.prototype.hide=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")&&null!=(e=this.controller)&&e.click(),this},c.prototype.get=function(e){return this.scripts.get(e)},c.prototype.register=function(e){var t=this.storage,t=new n(e,t);return this.scripts.set(e,t),this.render(),t},c.prototype.show=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")||null!=(e=this.controller)&&e.click(),this},c.prototype.unregister=function(e){var t=this.scripts,n=t.get(e);return n&&(t.delete(e),this.render()),n},t=c,e=(e=unsafeWindow.UserScripters||(unsafeWindow.UserScripters={})).Userscripts||(e.Userscripts={}),t=new t(i.locateStorage()),e.Configurer||(e.Configurer=t),i=document.createElement("style"),document.head.append(i),(s=i.sheet)&&[".".concat(v,"-modal {\n                top: 20vh;\n            }"),".".concat(v,"-modal > .s-expandable--content:empty::after {\n                content: 'No userscripts to configure';\n            }"),".".concat(v,"-userscript:last-child {\n                margin-bottom: var(--su2) !important;\n            }")].forEach(function(e){return s.insertRule(e)}),t.render()):console.debug("[".concat(v,"] missing UserScripters storage"))},{once:!0});