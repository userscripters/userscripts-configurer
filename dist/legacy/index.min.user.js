// ==UserScript==
// @name           Userscripts Configurer
// @author         Oleg Valter <oleg.a.valter@gmail.com>
// @description    One script to configure them all
// @exclude        https://chat.meta.stackexchange.com/*
// @exclude        https://chat.stackexchange.com/*
// @exclude        https://stackexchange.com/*
// @grant          GM_getValue
// @grant          GM_setValue
// @grant          GM_deleteValue
// @grant          unsafeWindow
// @homepage       https://github.com/userscripters/userscripts-configurer#readme
// @match          https://stackoverflow.com/*
// @match          https://serverfault.com/*
// @match          https://superuser.com/*
// @match          https://*.stackexchange.com/*
// @match          https://askubuntu.com/*
// @match          https://stackapps.com/*
// @match          https://mathoverflow.net/*
// @match          https://pt.stackoverflow.com/*
// @match          https://ja.stackoverflow.com/*
// @match          https://ru.stackoverflow.com/*
// @match          https://es.stackoverflow.com/*
// @match          https://meta.stackoverflow.com/*
// @match          https://meta.serverfault.com/*
// @match          https://meta.superuser.com/*
// @match          https://meta.askubuntu.com/*
// @match          https://meta.mathoverflow.net/*
// @match          https://pt.meta.stackoverflow.com/*
// @match          https://ja.meta.stackoverflow.com/*
// @match          https://ru.meta.stackoverflow.com/*
// @match          https://es.meta.stackoverflow.com/*
// @namespace      userscripters
// @require        https://github.com/userscripters/storage/raw/master/dist/browser.js
// @run-at         document-start
// @source         git+https://github.com/userscripters/userscripts-configurer.git
// @supportURL     https://github.com/userscripters/userscripts-configurer/issues
// @version        2.1.1
// ==/UserScript==

"use strict";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,o,s,c){return new(s=s||Promise)(function(n,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function a(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,a)}i((c=c.apply(e,o||[])).next())})},__generator=this&&this.__generator||function(r,a){var i,o,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,o=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))c.label=t[1];else if(6===t[0]&&c.label<s[1])c.label=s[1],s=t;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(t)}}t=a.call(r,c)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__rest=this&&this.__rest||function(e,t){var n={};for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]]);return n},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};window.addEventListener("load",function(){return __awaiter(void 0,void 0,void 0,function(){var y,o,s,c,d,g,w,x,l,A,u,p,_,f,E,L,v,S,h,m,b,C,O,j,k,P,F,T;return __generator(this,function(e){switch(e.label){case 0:return(y="userscript-configurer",F=window.Store)?(o=function(e){return __spreadArray([],__read(e.children),!1).forEach(function(e){return e.remove()})},s=function(){var e=document.createElement("style"),t=(document.head.append(e),e.sheet);t&&[".".concat(y,"-modal {\n                top: 20vh;\n            }"),".".concat(y,"-modal > .s-expandable--content {\n                max-height: 60vh;\n                overflow-y: auto;\n            }"),".".concat(y,"-modal > .s-expandable--content:empty::after {\n                content: 'No userscripts to configure';\n            }"),".".concat(y,"-userscript:last-child {\n                margin-bottom: var(--su2) !important;\n            }"),".".concat(y,"-userscript-toast {\n                top: 20vh;\n                left: unset;\n            }"),".".concat(y,"-userscript-option:last-child {\n                margin-bottom: 0 !important;\n            }")].forEach(function(e){return t.insertRule(e)})},c=function(e,t,n){var n=void 0===n?{}:n,r=n.classes,r=void 0===r?[]:r,a=n.title,i=n.danger,i=void 0!==i&&i,o=n.loading,o=void 0!==o&&o,s=n.muted,s=void 0!==s&&s,c=n.parent,d=n.primary,d=void 0!==d&&d,n=n.type,n=void 0===n?"filled":n,l=document.createElement("button"),e=(l.id=e,l.textContent=t,(e=l.classList).add.apply(e,__spreadArray(["s-btn","s-btn__".concat(n)],__read(r),!1)),l.setAttribute("role","button"),l.setAttribute("aria-label",a||t),l.classList);return i&&e.add("s-btn__danger"),s&&e.add("s-btn__muted"),d&&e.add("s-btn__primary"),o&&e.add("is-loading"),a&&(l.title=a),null!=c&&c.append(l),l},d=function(e,t,n){var r=(n=void 0===n?{}:n).classes,r=void 0===r?[]:r,a=n.content,a=void 0===a?[]:a,i=n.contentClasses,i=void 0===i?[]:i,o=n.controllerClasses,s=n.expanded,s=void 0!==s&&s,n=n.parent,c=document.createElement("div"),d=((d=c.classList).add.apply(d,__spreadArray(["s-expandable"],__read(r),!1)),c.id=e,s&&c.classList.add("is-expanded"),document.createElement("div")),r=((r=d.classList).add.apply(r,__spreadArray(["s-expandable--content"],__read(i),!1)),d.append.apply(d,__spreadArray([],__read(a),!1)),t.dataset);return r.controller="s-expandable-control",o&&(r.sExpandableControlToggleClass=o.join(" ")),t.setAttribute("aria-controls",e),t.setAttribute("aria-expanded",JSON.stringify(s)),c.append(d),null!=n&&n.append(c),c},g=function(e,t){var n=(t=void 0===t?{}:t).classes,n=void 0===n?[]:n,r=t.description,r=void 0===r?"":r,a=t.parent,i=t.placeholder,i=void 0===i?"":i,o=t.title,o=void 0===o?"":o,t=t.value,t=void 0===t?"":t,s=document.createElement("div"),c=((c=s.classList).add.apply(c,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(n),!1)),document.createElement("div")),n=(c.classList.add("d-flex","ps-relative"),document.createElement("input"));return n.classList.add("s-input"),n.id=e,n.type="text",n.placeholder=i,n.value=t,c.append(n),s.append(c),o?((i=document.createElement("div")).classList.add("flex--item"),(t=document.createElement("label")).classList.add("d-block","s-label"),t.htmlFor=e,t.textContent=o,r&&((c=document.createElement("p")).classList.add("s-description","mt2"),c.textContent=r,t.append(c)),i.append(t),s.prepend(i),[s,n,t]):(null!=a&&a.append(s),[s,n])},w=function(e,t){var n=t.items,n=void 0===n?[]:n,t=t.classes,t=void 0===t?[]:t,r=document.createElement("fieldset"),a=((a=r.classList).add.apply(a,__spreadArray([],__read(t),!1)),r.id=e,n.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.id,r=e.label,a=e.name,i=e.selected,i=void 0!==i&&i,e=e.value,e=void 0===e?"":e,o=document.createElement("div"),s=o.classList,s=(s.add("d-flex","gs8"),t&&s.add("is-disabled"),document.createElement("div")),c=(s.classList.add("flex--item"),document.createElement("input")),t=(c.classList.add("s-checkbox"),c.disabled=t,c.id=n||a,c.name=a,c.type="checkbox",c.checked=i,c.value=e,document.createElement("label"));return t.classList.add("flex--item","s-label","fw-normal"),t.htmlFor=n||a,t.textContent=r,s.append(c),o.append(s,t),o}));return r.append.apply(r,__spreadArray([],__read(a),!1)),[r]},x=function(e,t){var n,r=t.classes,r=void 0===r?[]:r,a=t.description,a=void 0===a?"":a,i=t.disabled,i=void 0!==i&&i,o=t.items,o=void 0===o?[]:o,s=t.title,s=void 0===s?"":s,t=t.value,t=void 0===t?"":t,c=document.createElement("div"),s=((n=c.classList).add.apply(n,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(r),!1)),s&&((n=document.createElement("label")).classList.add("d-block","s-label"),n.htmlFor=e,n.textContent=s,a&&((r=document.createElement("p")).classList.add("s-description","mt2"),r.textContent=a,n.append(r)),c.append(n)),document.createElement("div")),a=(s.classList.add("flex--item","s-select"),document.createElement("select")),r=(a.id=e,a.disabled=i,o.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.label,r=e.selected,r=void 0!==r&&r,e=e.value,e=void 0===e?"":e,a=document.createElement("option");return a.selected=r,a.value=e,a.textContent=n,a.disabled=t,a}));return a.append.apply(a,__spreadArray([],__read(r),!1)),a.value=t,s.append(a),c.append(s),[c,a]},l=function(e,t,n){var r=(n=void 0===n?{}:n).classes,r=void 0===r?[]:r,a=n.width,a=void 0===a?14:a,n=n.height,n=void 0===n?a:n,i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg"),s=((s=o.classList).add.apply(s,__spreadArray(["svg-icon",e],__read(r),!1)),o.setAttribute("width",a.toString()),o.setAttribute("height",n.toString()),o.setAttribute("viewBox","0 0 ".concat(a," ").concat(n)),o.setAttribute("aria-hidden","true"),document.createElementNS(i,"path"));return s.setAttribute("d",t),o.append(s),[o,s]},A=function(e,t){var n=t.classes,n=void 0===n?[]:n,r=t.description,a=t.disabled,a=void 0!==a&&a,i=t.direction,i=void 0===i?"right":i,o=t.selected,o=void 0!==o&&o,t=t.title,s=document.createElement("div"),c=((c=s.classList).add.apply(c,__spreadArray(["d-flex","ai-center","gs8"],__read(n),!1)),s.classList.toggle("disabled-area",a),document.createElement("label")),a=(c.classList.add("flex--item","s-label"),c.htmlFor=e,c.textContent=t,r&&((n=document.createElement("p")).classList.add("s-description","mt2"),n.textContent=r,c.append(n)),document.createElement("div")),t=(a.classList.add("flex--item","s-toggle-switch"),document.createElement("input")),r=(t.type="checkbox",t.id=e,t.checked=o,document.createElement("div"));return r.classList.add("s-toggle-switch--indicator"),a.append(t,r),s.append.apply(s,__spreadArray([],__read("right"===i?[c,a]:[a,c]),!1)),[s,t]},u=function(e,t,n){var r=(n=void 0===n?{}:n).buttons,r=void 0===r?[]:r,a=n.classes,a=void 0===a?[]:a,i=n.important,i=void 0!==i&&i,o=n.msgClasses,o=void 0===o?[]:o,s=n.parent,n=n.type,n=void 0===n?"none":n,c=document.createElement("div"),d=((d=c.classList).add.apply(d,__spreadArray(["s-toast"],__read(a),!1)),c.setAttribute("aria-hidden","true"),c.setAttribute("role","alertdialog"),c.setAttribute("aria-labelledby","notice-message"),c.id=e,document.createElement("aside")),a=(d.classList.add("s-notice","p8","pl16"),"none"!==n&&d.classList.add("s-notice__".concat(n)),i&&d.classList.add("s-notice__important"),document.createElement("div")),n=((e=a.classList).add.apply(e,__spreadArray(["d-flex","gs16","gsx","ai-center","jc-space-between"],__read(o),!1)),document.createElement("div")),i=(n.classList.add("flex--item"),n.textContent=t,document.createElement("div")),e=(i.classList.add("d-flex"),document.createElement("button"));e.type="button",e.classList.add("s-btn","s-notice--btn"),e.setAttribute("aria-label","Dismiss"),r.push(e);o=__read(l("iconClearSm","M12 3.41 10.59 2 7 5.59 3.41 2 2 3.41 5.59 7 2 10.59 3.41 12 7 8.41 10.59 12 12 10.59 8.41 7 12 3.41z"),1)[0];return e.append(o),i.append.apply(i,__spreadArray([],__read(r),!1)),a.append(n,i),d.append(a),c.append(d),s&&s.append(c),c},p=function(e,t){var n,r="string"==typeof e?document.querySelector(e):e;if(r)return n="true"!==(null==r?void 0:r.getAttribute("aria-hidden")),r.setAttribute("aria-hidden",(void 0!==t?!t:n).toString()),r;throw new ReferenceError("missing toast: ".concat(e))},_=function(e,t){var n=p(e,!1);t&&setTimeout(function(){return f(n)},1e3*t)},f=function(e,t){var n=p(e,!0);t&&setTimeout(function(){return _(n)},1e3*t)},E=function(t){return[HTMLInputElement,HTMLSelectElement].some(function(e){return t instanceof e})},L=function(e){return e instanceof HTMLInputElement&&e.checked},v=function(e){return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()},S=function(e){return e.split(/[-.]/).map(v).join(" ")},h=function(e,t,n){var r=n.classes,r=void 0===r?[]:r,a=n.iconContent,a=void 0===a?[]:a,i=n.linkClickable,i=void 0===i||i,n=n.parent,o=document.createElement("li"),e=(o.classList.toggle("c-pointer",!i),o.id=e,o.setAttribute("role","none"),document.createElement(i?"a":"div")),i=((i=e.classList).add.apply(i,__spreadArray(["s-topbar--item"],__read(r),!1)),e.title=t,document.createElementNS("http://www.w3.org/2000/svg","svg"));return i.classList.add("svg-icon","native"),i.setAttribute("height","18"),i.setAttribute("width","18"),i.setAttribute("viewBox","0 0 18 18"),i.append.apply(i,__spreadArray([],__read(a),!1)),e.append(i),o.append(e),null!=n&&n.append(o),o},m=function(e,t,n){var r=n.width,r=void 0===r?1:r,a=n.height,a=void 0===a?1:a,n=n.color,n=void 0===n?"black":n,i=document.createElementNS("http://www.w3.org/2000/svg","rect");return i.setAttribute("fill",n),i.setAttribute("height",a.toFixed(0)),i.setAttribute("width",r.toFixed(0)),i.setAttribute("x",t.toFixed(0)),i.setAttribute("y",e.toFixed(0)),i},b=function(e,t,n){var r,a=n.classes,a=void 0===a?[]:a,i=n.color,i=void 0===i?"black":i,o=n.halign,o=void 0===o?"start":o,s=n.size,s=void 0===s?12:s,c=n.text,c=void 0===c?"":c,d=n.valign,d=void 0===d?"top":d,n=n.weight,n=void 0===n?"normal":n,s="number"==typeof s?"".concat(s.toFixed(0),"px"):s,n="number"==typeof n?n.toFixed(0):n,d="middle"===d?"central":"text-".concat(d),t="number"==typeof t?t.toFixed(0):t,e="number"==typeof e?e.toFixed(0):e,l=document.createElementNS("http://www.w3.org/2000/svg","text");return(r=l.classList).add.apply(r,__spreadArray([],__read(a),!1)),l.setAttribute("fill",i),l.setAttribute("dominant-baseline",d),l.setAttribute("font-size",s),l.setAttribute("font-weight",n),l.setAttribute("text-anchor",o),l.setAttribute("x",t),l.setAttribute("y",e),l.textContent=c,l},C=function(e,t,n){var r={height:9,width:9},a=m(0,0,__assign({color:"#66d9ef"},r)),i=m(0,9,__assign({color:"#f92342"},r)),o=m(9,9,__assign({color:"#99e227"},r)),r=m(9,0,__assign({color:"#8d81ff"},r)),s={family:"Helvetica, Arial, sans-serif",halign:"middle",size:5,valign:"middle",weight:600},c=b("25%","25%",__assign({color:"#f92342",text:"U"},s)),d=b("25%","75%",__assign({color:"#66d9ef",text:"S"},s)),l=b("75%","25%",__assign({color:"#99e227",text:"E"},s)),s=b("75%","75%",__assign({color:"#8d81ff",text:"R"},s));return h(e,t,__assign(__assign({},n),{linkClickable:!1,iconContent:[a,i,o,r,c,d,l,s]}))},i.prototype.shouldDisable=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,a,i,o,s,c,d;return __generator(this,function(e){switch(e.label){case 0:t=(n=this).config,n=n.script,r=Object.entries(t.disabledWhen||{}),e.label=1;case 1:e.trys.push([1,6,7,8]),a=__values(r),i=a.next(),e.label=2;case 2:return i.done?[3,5]:(o=__read(i.value,2),s=o[0],o=o[1],n.get(s)?[4,n.load(s,t.def)]:[3,4]);case 3:if(s=e.sent(),o===s)return[2,!0];e.label=4;case 4:return i=a.next(),[3,2];case 5:return[3,8];case 6:return c=e.sent(),c={error:c},[3,8];case 7:try{i&&!i.done&&(d=a.return)&&d.call(a)}finally{if(c)throw c.error}return[7];case 8:return[2,!1]}})})},i.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var s,c,t,n,r,a,d,i,o,l,u,p,_,f,v,h,m,b=this;return __generator(this,function(e){switch(e.label){case 0:return _=(t=this).config,s=t.name,c=t.script,t={toggle:A,text:g,select:x,checkbox:w},n=_.desc,v=_.def,_.disabledWhen,r=_.items,r=void 0===r?[]:r,a=_.title,a=void 0===a?"":a,i=_.type,d=void 0===i?"text":i,i=__rest(_,["desc","def","disabledWhen","items","title","type"]),[4,c.load(s,v)];case 1:return o=e.sent(),l=Array.isArray(o),u="boolean"==typeof o,p="".concat(y,"-").concat(c.name,"-").concat(s),f=[__assign({},i)],m={classes:["".concat(y,"-userscript-option"),"mb16"]},[4,this.shouldDisable()];case 2:return _=__assign.apply(void 0,f.concat([(m.disabled=e.sent(),m.items=r.map(function(e,t){var n=e.value,r=e.name,a=e.selected,e=__rest(e,["value","name","selected"]);return __assign(__assign({},e),{name:r||"".concat(p,"-item-").concat(t),selected:l&&void 0!==n?o.includes(n):a,value:n})}),m.description=n,m.title=a||S(s),m)])),l||u||(_.value=o),"toggle"===d&&(_.selected=!!o),v=__read(t[d](p,_),1),h=v[0],(this.container=h).addEventListener("change",function(e){var i=e.currentTarget,o=e.target;return __awaiter(b,void 0,void 0,function(){var t,n,r,a;return __generator(this,function(e){switch(e.label){case 0:return E(o)?[4,c.load(s)]:[2];case 1:return t=e.sent(),n=i instanceof HTMLFieldSetElement?{value:__spreadArray([],__read(i.elements),!1).filter(L).map(function(e){return e.value})}:o,n="toggle"===d&&n instanceof HTMLInputElement?n.checked:n.value,[4,c.save(s,n)];case 2:return e.sent(),r=new CustomEvent("".concat(y,"-change"),{bubbles:!0,detail:{name:s,oldValue:t,script:c.name,value:n}}),null!=(a=c.container)&&a.dispatchEvent(r),[2]}})})}),[2,h]}})})},O=i,a=F.default,__extends(r,a),r.prototype.get=function(e){return this.opts.get(e)},r.prototype.has=function(e){return this.opts.has(e)},r.prototype.option=function(e,t){return this.opts.set(e,new O(this,e,t)),this.render(),this},r.prototype.options=function(e,t){var n=this,r=this.opts,a=t||{};return Object.entries(e).forEach(function(e){var e=__read(e,2),t=e[0],e=e[1];r.set(t,new O(n,t,__assign(__assign({},a),e)))}),this.render(),this},r.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,a,i=this;return __generator(this,function(e){switch(e.label){case 0:return a=(r=this).name,r=r.opts,(t=this.container||(this.container=document.createElement("div"))).classList.add("".concat(y,"-userscript"),"d-flex","fd-column","mb24"),(n=document.createElement("h2")).textContent=S(a),(a=__spreadArray([],__read(r),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()})).length||n.classList.add("mb8"),this.toast||(this.toast=u("".concat(y,"-toast"),"Updated ".concat(y," config"),{classes:["".concat(y,"-userscript-toast"),"wmn3","r0","jc-end"],type:"success"})),t.addEventListener("".concat(y,"-change"),function(){var e=i.toast;e&&f(e,1),i.render()}),[4,Promise.all(a)];case 1:return r=e.sent(),o(t),t.append.apply(t,__spreadArray([this.toast,n],__read(r),!1)),r.length||((a=document.createElement("div")).textContent="No configuration options available",t.append(a)),[2,t]}})})},j=r,Object.defineProperty(n.prototype,"footerParent",{get:function(){return document.querySelector(".site-footer--categories-nav ul")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"navParent",{get:function(){return document.querySelector(".js-top-bar .s-topbar--content")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sidebarParent",{get:function(){return document.body},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var e=this.position;return this["".concat(e,"Parent")]},enumerable:!1,configurable:!0}),n.prototype.setPosition=function(e){return this.position=e,this},n.prototype.toggle=function(){var e;return null!=(e=this.container)&&e.click(),this},n.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,a,i;return __generator(this,function(e){return t={footer:["s-btn__link"],sidebar:["ps-fixed","r0","t128"]},n={footer:c,nav:C,sidebar:c},r=(i=this).parent,a=i.position,i=i.text,[2,this.container||(this.container=n[a]("".concat(y,"-modal-controller"),i,{parent:r,type:"outlined",muted:!0,classes:__spreadArray(__spreadArray([],__read(t[a]||[]),!1),["bar0"],!1)}))]})})},k=n,t.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,a,i;return __generator(this,function(e){switch(e.label){case 0:return t=__spreadArray([],__read(this.scripts),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()}),r=this.get(y),n=this.controller,[4,null==r?void 0:r.load("button-position")];case 1:return r=e.sent()||"sidebar",n.setPosition(r),[4,n.render()];case 2:return(a=e.sent(),this.modal||(this.modal=d("".concat(y,"-modal"),a,{classes:["ps-fixed","r0","z-modal","".concat(y,"-modal")],contentClasses:["ba","bar-lg","bc-black-075","bg-white","p16","wmn3"],expanded:!1,parent:document.body})),a=this.modal.querySelector(".s-expandable--content"))?[4,Promise.all(t)]:(console.debug("[".concat(y,"] missing modal content element")),[2,this]);case 3:return i=e.sent(),o(a),a.append.apply(a,__spreadArray([],__read(i),!1)),[2,this]}})})},t.prototype.has=function(e){return this.scripts.has(e)},t.prototype.hide=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")&&null!=(e=this.controller)&&e.toggle(),this},t.prototype.get=function(e){return this.scripts.get(e)},t.prototype.register=function(e,t){t=new j(e,t||this.storage);return this.scripts.set(e,t),this.render(),t},t.prototype.show=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")||null!=(e=this.controller)&&e.toggle(),this},t.prototype.unregister=function(e){var t=this.scripts,n=t.get(e);return n&&(t.delete(e),this.render()),n},T=t,P=unsafeWindow.UserScripters||(unsafeWindow.UserScripters={}),P=P.Userscripts||(P.Userscripts={}),F=F.locateStorage(),T=new T(F),P.Configurer||(P.Configurer=T),s(),T.register(y,F).options({"button-position":{def:"sidebar",desc:'Changes where the "UserScripters" button appears in the UI',items:[{label:"Footer",value:"footer"},{label:"Navigation",value:"nav"},{label:"Sidebar",value:"sidebar"}],title:"Button Placement",type:"select"}}),[4,T.render()]):(console.debug("[".concat(y,"] missing UserScripters storage")),[2]);case 1:return e.sent(),unsafeWindow.dispatchEvent(new CustomEvent("".concat(y,"-load"))),[2]}function t(e){this.storage=e,this.controller=new k("UserScripters"),this.scripts=new Map}function n(e){this.text=e,this.position="sidebar"}function r(e,t){var n=a.call(this,e,t)||this;return n.name=e,n.storage=t,n.opts=new Map,n}var a;function i(e,t,n){this.script=e,this.name=t,this.config=n}})})},{once:!0});