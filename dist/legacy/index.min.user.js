// ==UserScript==
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     One configurer to setup them all
// @grant           GM_deleteValue
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           unsafeWindow
// @homepage        https://github.com/userscripters/userscripts-configurer#readme
// @match           https://*.stackexchange.com/*
// @match           https://askubuntu.com/*
// @match           https://es.meta.stackoverflow.com/*
// @match           https://es.stackoverflow.com/*
// @match           https://ja.meta.stackoverflow.com/*
// @match           https://ja.stackoverflow.com/*
// @match           https://mathoverflow.net/*
// @match           https://meta.askubuntu.com/*
// @match           https://meta.mathoverflow.net/*
// @match           https://meta.serverfault.com/*
// @match           https://meta.stackoverflow.com/*
// @match           https://meta.superuser.com/*
// @match           https://pt.meta.stackoverflow.com/*
// @match           https://pt.stackoverflow.com/*
// @match           https://ru.meta.stackoverflow.com/*
// @match           https://ru.stackoverflow.com/*
// @match           https://serverfault.com/*
// @match           https://stackapps.com/*
// @match           https://stackoverflow.com/*
// @match           https://superuser.com/*
// @name            Userscripts Configurer
// @namespace       userscripters
// @require         https://github.com/userscripters/storage/raw/master/dist/browser.js
// @run-at          document-start
// @source          git+https://github.com/userscripters/userscripts-configurer.git
// @supportURL      https://github.com/userscripters/userscripts-configurer/issues
// @version         0.1.0
// ==/UserScript==

"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__read=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,s=r.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(n=s.next()).done;)o.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(a)throw a.error}}return o},__spreadArray=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,a=0,s=t.length;a<s;a++)!n&&a in t||((n=n||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))};window.addEventListener("load",function(){var m,n,o,r,a,e,t,s,f="userscript-configurer",d=window.Store;function i(e,t){var r=a.call(this,e,t)||this;return r.name=e,r.storage=t,r.options=new Map,r}function c(e){this.storage=e,this.scripts=new Map}d?(m=function(e){return __spreadArray([],__read(e.children),!1).forEach(function(e){return e.remove()})},n=function(e,t){var r=(t=void 0===t?{}:t).classes,r=void 0===r?[]:r,n=t.description,n=void 0===n?"":n,a=t.parent,s=t.placeholder,s=void 0===s?"":s,o=t.title,o=void 0===o?"":o,t=t.value,t=void 0===t?"":t,d=document.createElement("div"),i=((i=d.classList).add.apply(i,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(r),!1)),document.createElement("div")),r=(i.classList.add("d-flex","ps-relative"),document.createElement("input"));return r.classList.add("s-input"),r.id=e,r.type="text",r.placeholder=s,r.value=t,i.append(r),d.append(i),o?((s=document.createElement("div")).classList.add("flex--item"),(t=document.createElement("label")).classList.add("d-block","s-label"),t.htmlFor=e,t.textContent=o,n&&((i=document.createElement("p")).classList.add("s-description","mt2"),i.textContent=n,t.append(i)),s.append(t),d.prepend(s),[d,r,t]):(null!=a&&a.append(d),[d,r])},o=function(e,t){var r=t.checkboxes,r=void 0===r?[]:r,t=t.classes,t=void 0===t?[]:t,n=document.createElement("fieldset"),a=((a=n.classList).add.apply(a,__spreadArray(["mt8"],__read(t),!1)),n.id=e,r.map(function(e){var t=e.disabled,t=void 0!==t&&t,r=e.id,n=e.label,a=e.name,e=e.selected,e=void 0!==e&&e,s=document.createElement("div"),o=s.classList,o=(o.add("d-flex","gs8"),t&&o.add("is-disabled"),document.createElement("div")),d=(o.classList.add("flex--item"),document.createElement("input")),t=(d.classList.add("s-checkbox"),d.disabled=t,d.id=r||a,d.name=a,d.type="checkbox",d.checked=e,document.createElement("label"));return t.classList.add("flex--item","s-label","fw-normal"),t.htmlFor=r||a,t.textContent=n,o.append(d),s.append(o,t),s}));return n.append.apply(n,__spreadArray([],__read(a),!1)),[n]},a=null==d?void 0:d.default,__extends(i,a),i.prototype.option=function(e,t,r,n){return this.options.set(e,{name:e,desc:t,def:n,type:r}),this.render(),this},i.prototype.render=function(){var a=this.name,e=this.options,t=this.container||(this.container=document.createElement("div")),r=(t.classList.add("".concat(f,"-userscript"),"d-flex","fd-column","mb24"),document.createElement("h2")),s=(r.classList.add("mb8"),r.textContent=a,{text:n,checkbox:o}),e=__spreadArray([],__read(e),!1).map(function(e){var e=__read(e,2),t=e[0],e=e[1],r=e.desc,n=e.def,e=e.type;return __read(s[void 0===e?"text":e]("".concat(f,"-").concat(a,"-").concat(t),{checkboxes:[{label:r,name:t,selected:n}],description:r,title:t,value:n}),1)[0]});return m(t),t.append.apply(t,__spreadArray([r],__read(e),!1)),e.length||((r=document.createElement("div")).textContent="No configuration options available",t.append(r)),t},r=i,c.prototype.render=function(){var e,t,r,n,a,s,o,d,i,c,l={parent:document.body},p=["ps-fixed","r0"],u=__spreadArray([],__read(this.scripts),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()}),_=(this.controller||(this.controller=(d="".concat(f,"-modal-controller"),r="UserScripters",e=__assign(__assign({},l),{type:"outlined",muted:!0,classes:__spreadArray(__spreadArray([],__read(p),!1),["bar0","t128"],!1)}),t=void 0===(t=(e=void 0===e?{}:e).classes)?[]:t,i=e.title,n=void 0!==(n=e.danger)&&n,o=void 0!==(o=e.loading)&&o,a=void 0!==(a=e.muted)&&a,c=e.parent,s=void 0!==(s=e.primary)&&s,e=void 0===(e=e.type)?"filled":e,(_=document.createElement("button")).id=d,_.textContent=r,(d=_.classList).add.apply(d,__spreadArray(["s-btn","s-btn__".concat(e)],__read(t),!1)),_.setAttribute("role","button"),_.setAttribute("aria-label",i||r),d=_.classList,n&&d.add("s-btn__danger"),a&&d.add("s-btn__muted"),s&&d.add("s-btn__primary"),o&&d.add("is-loading"),i&&(_.title=i),null!=c&&c.append(_),_)),this.modal||(this.modal=(e="".concat(f,"-modal"),t=this.controller,r=__assign(__assign({},l),{classes:__spreadArray(__spreadArray([],__read(p),!1),["z-modal","".concat(f,"-modal")],!1),contentClasses:["ba","bar-lg","bc-black-075","bg-white","p16","wmn3"],expanded:!1}),n=void 0===(n=(r=void 0===r?{}:r).classes)?[]:n,a=void 0===(a=r.content)?[]:a,s=void 0===(s=r.contentClasses)?[]:s,o=r.controllerClasses,d=void 0!==(d=r.expanded)&&d,r=r.parent,i=document.createElement("div"),(c=i.classList).add.apply(c,__spreadArray(["s-expandable"],__read(n),!1)),i.id=e,d&&i.classList.add("is-expanded"),c=document.createElement("div"),(n=c.classList).add.apply(n,__spreadArray(["s-expandable--content"],__read(s),!1)),c.append.apply(c,__spreadArray([],__read(a),!1)),(n=t.dataset).controller="s-expandable-control",o&&(n.sExpandableControlToggleClass=o.join(" ")),t.setAttribute("aria-controls",e),t.setAttribute("aria-expanded",JSON.stringify(d)),i.append(c),null!=r&&r.append(i),i)),this.modal.querySelector(".s-expandable--content"));return _?(m(_),_.append.apply(_,__spreadArray([],__read(u),!1))):console.debug("[".concat(f,"] missing modal content element")),this},c.prototype.hide=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")&&null!=(e=this.controller)&&e.click(),this},c.prototype.get=function(e){return this.scripts.get(e)},c.prototype.register=function(e){var t=this.storage,t=new r(e,t);return this.scripts.set(e,t),this.render(),t},c.prototype.show=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")||null!=(e=this.controller)&&e.click(),this},c.prototype.unregister=function(e){var t=this.scripts,r=t.get(e);return r&&(t.delete(e),this.render()),r},t=c,e=(e=unsafeWindow.UserScripters||(unsafeWindow.UserScripters={})).Userscripts||(e.Userscripts={}),t=new t(d.locateStorage()),e.Configurer||(e.Configurer=t),d=document.createElement("style"),document.head.append(d),(s=d.sheet)&&[".".concat(f,"-modal {\n                top: 20vh;\n            }"),".".concat(f,"-modal > .s-expandable--content:empty::after {\n                content: 'No userscripts to configure';\n            }"),".".concat(f,"-userscript:last-child {\n                margin-bottom: var(--su2) !important;\n            }")].forEach(function(e){return s.insertRule(e)}),t.render()):console.debug("[".concat(f,"] missing UserScripters storage"))},{once:!0});