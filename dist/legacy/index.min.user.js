// ==UserScript==
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     One configurer to setup them all
// @grant           GM_deleteValue
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           unsafeWindow
// @homepage        https://github.com/userscripters/userscripts-configurer#readme
// @match           https://*.stackexchange.com/*
// @match           https://askubuntu.com/*
// @match           https://es.meta.stackoverflow.com/*
// @match           https://es.stackoverflow.com/*
// @match           https://ja.meta.stackoverflow.com/*
// @match           https://ja.stackoverflow.com/*
// @match           https://mathoverflow.net/*
// @match           https://meta.askubuntu.com/*
// @match           https://meta.mathoverflow.net/*
// @match           https://meta.serverfault.com/*
// @match           https://meta.stackoverflow.com/*
// @match           https://meta.superuser.com/*
// @match           https://pt.meta.stackoverflow.com/*
// @match           https://pt.stackoverflow.com/*
// @match           https://ru.meta.stackoverflow.com/*
// @match           https://ru.stackoverflow.com/*
// @match           https://serverfault.com/*
// @match           https://stackapps.com/*
// @match           https://stackoverflow.com/*
// @match           https://superuser.com/*
// @name            Userscripts Configurer
// @namespace       userscripters
// @require         https://github.com/userscripters/storage/raw/master/dist/browser.js
// @run-at          document-start
// @source          git+https://github.com/userscripters/userscripts-configurer.git
// @supportURL      https://github.com/userscripters/userscripts-configurer/issues
// @version         0.1.0
// ==/UserScript==

"use strict";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,o,i,d){return new(i=i||Promise)(function(n,t){function r(e){try{s(d.next(e))}catch(e){t(e)}}function a(e){try{s(d.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(r,a)}s((d=d.apply(e,o||[])).next())})},__generator=this&&this.__generator||function(r,a){var s,o,i,d={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;d;)try{if(s=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,(t=i?[2&t[0],i.value]:t)[0]){case 0:case 1:i=t;break;case 4:return d.label++,{value:t[1],done:!1};case 5:d.label++,o=t[1],t=[0];continue;case 7:t=d.ops.pop(),d.trys.pop();continue;default:if(!(i=0<(i=d.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){d=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){d.label=t[1];break}if(6===t[0]&&d.label<i[1]){d.label=i[1],i=t;break}if(i&&d.label<i[2]){d.label=i[2],d.ops.push(t);break}i[2]&&d.ops.pop(),d.trys.pop();continue}t=a.call(r,d)}catch(e){t=[6,e],o=0}finally{s=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};window.addEventListener("load",function(){var f,o,i,d,n,r,e,t,a,v="userscript-configurer",s=window.Store;function c(e,t){var n=r.call(this,e,t)||this;return n.name=e,n.storage=t,n.options=new Map,n}function l(e){this.storage=e,this.scripts=new Map}s?(f=function(e){return __spreadArray([],__read(e.children),!1).forEach(function(e){return e.remove()})},o=function(e,t){var n=(t=void 0===t?{}:t).classes,n=void 0===n?[]:n,r=t.description,r=void 0===r?"":r,a=t.parent,s=t.placeholder,s=void 0===s?"":s,o=t.title,o=void 0===o?"":o,t=t.value,t=void 0===t?"":t,i=document.createElement("div"),d=((d=i.classList).add.apply(d,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(n),!1)),document.createElement("div")),n=(d.classList.add("d-flex","ps-relative"),document.createElement("input"));return n.classList.add("s-input"),n.id=e,n.type="text",n.placeholder=s,n.value=t,d.append(n),i.append(d),o?((s=document.createElement("div")).classList.add("flex--item"),(t=document.createElement("label")).classList.add("d-block","s-label"),t.htmlFor=e,t.textContent=o,r&&((d=document.createElement("p")).classList.add("s-description","mt2"),d.textContent=r,t.append(d)),s.append(t),i.prepend(s),[i,n,t]):(null!=a&&a.append(i),[i,n])},i=function(e,t){var n=t.items,n=void 0===n?[]:n,t=t.classes,t=void 0===t?[]:t,r=document.createElement("fieldset"),a=((a=r.classList).add.apply(a,__spreadArray(["mt8"],__read(t),!1)),r.id=e,n.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.id,r=e.label,a=e.name,e=e.selected,e=void 0!==e&&e,s=document.createElement("div"),o=s.classList,o=(o.add("d-flex","gs8"),t&&o.add("is-disabled"),document.createElement("div")),i=(o.classList.add("flex--item"),document.createElement("input")),t=(i.classList.add("s-checkbox"),i.disabled=t,i.id=n||a,i.name=a,i.type="checkbox",i.checked=e,document.createElement("label"));return t.classList.add("flex--item","s-label","fw-normal"),t.htmlFor=n||a,t.textContent=r,o.append(i),s.append(o,t),s}));return r.append.apply(r,__spreadArray([],__read(a),!1)),[r]},d=function(e,t){var n,r=t.classes,r=void 0===r?[]:r,a=t.description,a=void 0===a?"":a,s=t.disabled,s=void 0!==s&&s,o=t.items,o=void 0===o?[]:o,i=t.title,i=void 0===i?"":i,t=t.value,t=void 0===t?"":t,d=document.createElement("div"),i=((n=d.classList).add.apply(n,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(r),!1)),i&&((n=document.createElement("label")).classList.add("d-block","s-label"),n.htmlFor=e,n.textContent=i,a&&((r=document.createElement("p")).classList.add("s-description","mt2"),r.textContent=a,n.append(r)),d.append(n)),document.createElement("div")),a=(i.classList.add("flex--item","s-select"),document.createElement("select")),r=(a.id=e,a.disabled=s,o.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.label,r=e.selected,r=void 0!==r&&r,e=e.value,e=void 0===e?"":e,a=document.createElement("option");return a.selected=r,a.value=e,a.textContent=n,a.disabled=t,a}));return a.append.apply(a,__spreadArray([],__read(r),!1)),a.value=t,i.append(a),d.append(i),[d,a]},r=null==s?void 0:s.default,__extends(c,r),c.prototype.option=function(e,t){return this.options.set(e,__assign({name:e},t)),this.render(),this},c.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var c,t,n,l,r,a,s=this;return __generator(this,function(e){switch(e.label){case 0:return c=(r=this).name,r=r.options,(t=this.container||(this.container=document.createElement("div"))).classList.add("".concat(v,"-userscript"),"d-flex","fd-column","mb24"),(n=document.createElement("h2")).classList.add("mb8"),n.textContent=c,l={text:o,select:d,checkbox:i},r=__spreadArray([],__read(r),!1).map(function(e){var e=__read(e,2),i=e[0],d=e[1];return __awaiter(s,void 0,void 0,function(){var t,n,r,a,s,o=this;return __generator(this,function(e){switch(e.label){case 0:return t=d.desc,a=d.def,n=d.items,n=void 0===n?[]:n,r=d.type,r=void 0===r?"text":r,[4,this.load(i,a)];case 1:return a=e.sent(),s=__read(l[r]("".concat(v,"-").concat(c,"-").concat(i),{items:n.map(function(e,t){return __assign(__assign({},e),{name:e.name||"".concat(v,"-").concat(c,"-").concat(i,"-item-").concat(t)})}),description:t,title:i,value:a}),1),(s=s[0]).addEventListener("change",function(e){var n=e.target;return __awaiter(o,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return(t=n,[HTMLInputElement,HTMLSelectElement].some(function(e){return t instanceof e}))?[4,this.save(i,n.value)]:[2];case 1:return e.sent(),[2]}var t})})}),[2,s]}})})}),[4,Promise.all(r)];case 1:return r=e.sent(),f(t),t.append.apply(t,__spreadArray([n],__read(r),!1)),r.length||((a=document.createElement("div")).textContent="No configuration options available",t.append(a)),[2,t]}})})},n=c,l.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var u,_,m;return __generator(this,function(e){switch(e.label){case 0:return(_={parent:document.body},m=["ps-fixed","r0"],u=__spreadArray([],__read(this.scripts),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()}),this.controller||(this.controller=(t="".concat(v,"-modal-controller"),n="UserScripters",r=__assign(__assign({},_),{type:"outlined",muted:!0,classes:__spreadArray(__spreadArray([],__read(m),!1),["bar0","t128"],!1)}),a=void 0===(a=(r=void 0===r?{}:r).classes)?[]:a,s=r.title,o=void 0!==(o=r.danger)&&o,i=void 0!==(i=r.loading)&&i,d=void 0!==(d=r.muted)&&d,c=r.parent,l=void 0!==(l=r.primary)&&l,r=void 0===(r=r.type)?"filled":r,(p=document.createElement("button")).id=t,p.textContent=n,(t=p.classList).add.apply(t,__spreadArray(["s-btn","s-btn__".concat(r)],__read(a),!1)),p.setAttribute("role","button"),p.setAttribute("aria-label",s||n),t=p.classList,o&&t.add("s-btn__danger"),d&&t.add("s-btn__muted"),l&&t.add("s-btn__primary"),i&&t.add("is-loading"),s&&(p.title=s),null!=c&&c.append(p),p)),this.modal||(this.modal=(r="".concat(v,"-modal"),a=this.controller,n=__assign(__assign({},_),{classes:__spreadArray(__spreadArray([],__read(m),!1),["z-modal","".concat(v,"-modal")],!1),contentClasses:["ba","bar-lg","bc-black-075","bg-white","p16","wmn3"],expanded:!1}),o=void 0===(o=(n=void 0===n?{}:n).classes)?[]:o,d=void 0===(d=n.content)?[]:d,l=void 0===(l=n.contentClasses)?[]:l,i=n.controllerClasses,t=void 0!==(t=n.expanded)&&t,n=n.parent,s=document.createElement("div"),(c=s.classList).add.apply(c,__spreadArray(["s-expandable"],__read(o),!1)),s.id=r,t&&s.classList.add("is-expanded"),c=document.createElement("div"),(o=c.classList).add.apply(o,__spreadArray(["s-expandable--content"],__read(l),!1)),c.append.apply(c,__spreadArray([],__read(d),!1)),(o=a.dataset).controller="s-expandable-control",i&&(o.sExpandableControlToggleClass=i.join(" ")),a.setAttribute("aria-controls",r),a.setAttribute("aria-expanded",JSON.stringify(t)),s.append(c),null!=n&&n.append(s),s)),_=this.modal.querySelector(".s-expandable--content"))?[4,Promise.all(u)]:(console.debug("[".concat(v,"] missing modal content element")),[2,this]);case 1:return m=e.sent(),f(_),_.append.apply(_,__spreadArray([],__read(m),!1)),[2,this]}var t,n,r,a,s,o,i,d,c,l,p})})},l.prototype.hide=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")&&null!=(e=this.controller)&&e.click(),this},l.prototype.get=function(e){return this.scripts.get(e)},l.prototype.register=function(e){var t=this.storage,t=new n(e,t);return this.scripts.set(e,t),this.render(),t},l.prototype.show=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")||null!=(e=this.controller)&&e.click(),this},l.prototype.unregister=function(e){var t=this.scripts,n=t.get(e);return n&&(t.delete(e),this.render()),n},t=l,e=(e=unsafeWindow.UserScripters||(unsafeWindow.UserScripters={})).Userscripts||(e.Userscripts={}),t=new t(s.locateStorage()),e.Configurer||(e.Configurer=t),s=document.createElement("style"),document.head.append(s),(a=s.sheet)&&[".".concat(v,"-modal {\n                top: 20vh;\n            }"),".".concat(v,"-modal > .s-expandable--content:empty::after {\n                content: 'No userscripts to configure';\n            }"),".".concat(v,"-userscript:last-child {\n                margin-bottom: var(--su2) !important;\n            }")].forEach(function(e){return a.insertRule(e)}),t.render()):console.debug("[".concat(v,"] missing UserScripters storage"))},{once:!0});