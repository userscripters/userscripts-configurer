// ==UserScript==
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     One script to configure them all
// @grant           GM_deleteValue
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           unsafeWindow
// @homepage        https://github.com/userscripters/userscripts-configurer#readme
// @match           https://*.stackexchange.com/*
// @match           https://askubuntu.com/*
// @match           https://es.meta.stackoverflow.com/*
// @match           https://es.stackoverflow.com/*
// @match           https://ja.meta.stackoverflow.com/*
// @match           https://ja.stackoverflow.com/*
// @match           https://mathoverflow.net/*
// @match           https://meta.askubuntu.com/*
// @match           https://meta.mathoverflow.net/*
// @match           https://meta.serverfault.com/*
// @match           https://meta.stackoverflow.com/*
// @match           https://meta.superuser.com/*
// @match           https://pt.meta.stackoverflow.com/*
// @match           https://pt.stackoverflow.com/*
// @match           https://ru.meta.stackoverflow.com/*
// @match           https://ru.stackoverflow.com/*
// @match           https://serverfault.com/*
// @match           https://stackapps.com/*
// @match           https://stackoverflow.com/*
// @match           https://superuser.com/*
// @name            Userscripts Configurer
// @namespace       userscripters
// @require         https://github.com/userscripters/storage/raw/master/dist/browser.js
// @run-at          document-start
// @source          git+https://github.com/userscripters/userscripts-configurer.git
// @supportURL      https://github.com/userscripters/userscripts-configurer/issues
// @version         1.1.0
// ==/UserScript==

"use strict";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,i,o,c){return new(o=o||Promise)(function(n,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function a(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(r,a)}s((c=c.apply(e,i||[])).next())})},__generator=this&&this.__generator||function(r,a){var s,i,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;c;)try{if(s=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,i=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(o=0<(o=c.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){c.label=t[1];break}if(6===t[0]&&c.label<o[1]){c.label=o[1],o=t;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(t);break}o[2]&&c.ops.pop(),c.trys.pop();continue}t=a.call(r,c)}catch(e){t=[6,e],i=0}finally{s=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__rest=this&&this.__rest||function(e,t){var n={};for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]]);return n},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return i},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};window.addEventListener("load",function(){return __awaiter(void 0,void 0,void 0,function(){var v,i,s,o,c,f,h,y,l,b,d,u,p,_,g,w,m,x,E,A,L,C,S;return __generator(this,function(e){switch(e.label){case 0:return(v="userscript-configurer",C=window.Store)?(i=function(e){return __spreadArray([],__read(e.children),!1).forEach(function(e){return e.remove()})},s=function(){var e=document.createElement("style"),t=(document.head.append(e),e.sheet);t&&[".".concat(v,"-modal {\n                top: 20vh;\n            }"),".".concat(v,"-modal > .s-expandable--content:empty::after {\n                content: 'No userscripts to configure';\n            }"),".".concat(v,"-userscript:last-child {\n                margin-bottom: var(--su2) !important;\n            }"),".".concat(v,"-userscript-toast {\n                top: 20vh;\n                left: unset;\n            }"),".".concat(v,"-userscript-option:last-child {\n                margin-bottom: 0 !important;\n            }")].forEach(function(e){return t.insertRule(e)})},o=function(e,t,n){var n=void 0===n?{}:n,r=n.classes,r=void 0===r?[]:r,a=n.title,s=n.danger,s=void 0!==s&&s,i=n.loading,i=void 0!==i&&i,o=n.muted,o=void 0!==o&&o,c=n.parent,d=n.primary,d=void 0!==d&&d,n=n.type,n=void 0===n?"filled":n,l=document.createElement("button"),e=(l.id=e,l.textContent=t,(e=l.classList).add.apply(e,__spreadArray(["s-btn","s-btn__".concat(n)],__read(r),!1)),l.setAttribute("role","button"),l.setAttribute("aria-label",a||t),l.classList);return s&&e.add("s-btn__danger"),o&&e.add("s-btn__muted"),d&&e.add("s-btn__primary"),i&&e.add("is-loading"),a&&(l.title=a),null!=c&&c.append(l),l},c=function(e,t,n){var r=(n=void 0===n?{}:n).classes,r=void 0===r?[]:r,a=n.content,a=void 0===a?[]:a,s=n.contentClasses,s=void 0===s?[]:s,i=n.controllerClasses,o=n.expanded,o=void 0!==o&&o,n=n.parent,c=document.createElement("div"),d=((d=c.classList).add.apply(d,__spreadArray(["s-expandable"],__read(r),!1)),c.id=e,o&&c.classList.add("is-expanded"),document.createElement("div")),r=((r=d.classList).add.apply(r,__spreadArray(["s-expandable--content"],__read(s),!1)),d.append.apply(d,__spreadArray([],__read(a),!1)),t.dataset);return r.controller="s-expandable-control",i&&(r.sExpandableControlToggleClass=i.join(" ")),t.setAttribute("aria-controls",e),t.setAttribute("aria-expanded",JSON.stringify(o)),c.append(d),null!=n&&n.append(c),c},f=function(e,t){var n=(t=void 0===t?{}:t).classes,n=void 0===n?[]:n,r=t.description,r=void 0===r?"":r,a=t.parent,s=t.placeholder,s=void 0===s?"":s,i=t.title,i=void 0===i?"":i,t=t.value,t=void 0===t?"":t,o=document.createElement("div"),c=((c=o.classList).add.apply(c,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(n),!1)),document.createElement("div")),n=(c.classList.add("d-flex","ps-relative"),document.createElement("input"));return n.classList.add("s-input"),n.id=e,n.type="text",n.placeholder=s,n.value=t,c.append(n),o.append(c),i?((s=document.createElement("div")).classList.add("flex--item"),(t=document.createElement("label")).classList.add("d-block","s-label"),t.htmlFor=e,t.textContent=i,r&&((c=document.createElement("p")).classList.add("s-description","mt2"),c.textContent=r,t.append(c)),s.append(t),o.prepend(s),[o,n,t]):(null!=a&&a.append(o),[o,n])},h=function(e,t){var n=t.items,n=void 0===n?[]:n,t=t.classes,t=void 0===t?[]:t,r=document.createElement("fieldset"),a=((a=r.classList).add.apply(a,__spreadArray([],__read(t),!1)),r.id=e,n.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.id,r=e.label,a=e.name,s=e.selected,s=void 0!==s&&s,e=e.value,e=void 0===e?"":e,i=document.createElement("div"),o=i.classList,o=(o.add("d-flex","gs8"),t&&o.add("is-disabled"),document.createElement("div")),c=(o.classList.add("flex--item"),document.createElement("input")),t=(c.classList.add("s-checkbox"),c.disabled=t,c.id=n||a,c.name=a,c.type="checkbox",c.checked=s,c.value=e,document.createElement("label"));return t.classList.add("flex--item","s-label","fw-normal"),t.htmlFor=n||a,t.textContent=r,o.append(c),i.append(o,t),i}));return r.append.apply(r,__spreadArray([],__read(a),!1)),[r]},y=function(e,t){var n,r=t.classes,r=void 0===r?[]:r,a=t.description,a=void 0===a?"":a,s=t.disabled,s=void 0!==s&&s,i=t.items,i=void 0===i?[]:i,o=t.title,o=void 0===o?"":o,t=t.value,t=void 0===t?"":t,c=document.createElement("div"),o=((n=c.classList).add.apply(n,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(r),!1)),o&&((n=document.createElement("label")).classList.add("d-block","s-label"),n.htmlFor=e,n.textContent=o,a&&((r=document.createElement("p")).classList.add("s-description","mt2"),r.textContent=a,n.append(r)),c.append(n)),document.createElement("div")),a=(o.classList.add("flex--item","s-select"),document.createElement("select")),r=(a.id=e,a.disabled=s,i.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.label,r=e.selected,r=void 0!==r&&r,e=e.value,e=void 0===e?"":e,a=document.createElement("option");return a.selected=r,a.value=e,a.textContent=n,a.disabled=t,a}));return a.append.apply(a,__spreadArray([],__read(r),!1)),a.value=t,o.append(a),c.append(o),[c,a]},l=function(e,t,n){var r=(n=void 0===n?{}:n).classes,r=void 0===r?[]:r,a=n.width,a=void 0===a?14:a,n=n.height,n=void 0===n?a:n,s="http://www.w3.org/2000/svg",i=document.createElementNS(s,"svg"),o=((o=i.classList).add.apply(o,__spreadArray(["svg-icon",e],__read(r),!1)),i.setAttribute("width",a.toString()),i.setAttribute("height",n.toString()),i.setAttribute("viewBox","0 0 ".concat(a," ").concat(n)),i.setAttribute("aria-hidden","true"),document.createElementNS(s,"path"));return o.setAttribute("d",t),i.append(o),[i,o]},b=function(e,t){var n=t.classes,n=void 0===n?[]:n,r=t.selected,r=void 0!==r&&r,t=t.title,a=document.createElement("div"),s=((s=a.classList).add.apply(s,__spreadArray(["d-flex","ai-center","gs8"],__read(n),!1)),document.createElement("label")),n=(s.classList.add("flex--item","s-label"),s.htmlFor=e,s.textContent=t,document.createElement("div")),t=(n.classList.add("flex--item","s-toggle-switch"),document.createElement("input")),e=(t.type="checkbox",t.id=e,t.checked=r,document.createElement("div"));return e.classList.add("s-toggle-switch--indicator"),n.append(t,e),a.append(s,n),[a,t]},d=function(e,t,n){var r=(n=void 0===n?{}:n).buttons,r=void 0===r?[]:r,a=n.classes,a=void 0===a?[]:a,s=n.important,s=void 0!==s&&s,i=n.msgClasses,i=void 0===i?[]:i,o=n.parent,n=n.type,n=void 0===n?"none":n,c=document.createElement("div"),d=((d=c.classList).add.apply(d,__spreadArray(["s-toast"],__read(a),!1)),c.setAttribute("aria-hidden","true"),c.setAttribute("role","alertdialog"),c.setAttribute("aria-labelledby","notice-message"),c.id=e,document.createElement("aside")),a=(d.classList.add("s-notice","p8","pl16"),"none"!==n&&d.classList.add("s-notice__".concat(n)),s&&d.classList.add("s-notice__important"),document.createElement("div")),n=((e=a.classList).add.apply(e,__spreadArray(["d-flex","gs16","gsx","ai-center","jc-space-between"],__read(i),!1)),document.createElement("div")),s=(n.classList.add("flex--item"),n.textContent=t,document.createElement("div")),e=(s.classList.add("d-flex"),document.createElement("button"));e.type="button",e.classList.add("s-btn","s-notice--btn"),e.setAttribute("aria-label","Dismiss"),r.push(e);i=__read(l("iconClearSm","M12 3.41 10.59 2 7 5.59 3.41 2 2 3.41 5.59 7 2 10.59 3.41 12 7 8.41 10.59 12 12 10.59 8.41 7 12 3.41z"),1)[0];return e.append(i),s.append.apply(s,__spreadArray([],__read(r),!1)),a.append(n,s),d.append(a),c.append(d),o&&o.append(c),c},u=function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new ReferenceError("missing toast: ".concat(e));e="true"!==(null==n?void 0:n.getAttribute("aria-hidden"));return n.setAttribute("aria-hidden",(void 0!==t?!t:e).toString()),n},p=function(e,t){var n=u(e,!1);t&&setTimeout(function(){return _(n)},1e3*t)},_=function(e,t){var n=u(e,!0);t&&setTimeout(function(){return p(n)},1e3*t)},g=function(t){return[HTMLInputElement,HTMLSelectElement].some(function(e){return t instanceof e})},w=function(e){return e instanceof HTMLInputElement&&e.checked},m=function(e){return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()},x=function(e){return e.split(/[-.]/).map(m).join(" ")},a.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var s,t,n,i,r,a,o,c,d,l,u,p,_,m=this;return __generator(this,function(e){switch(e.label){case 0:return l=(t=this).config,s=t.script,t={toggle:b,text:f,select:y,checkbox:h},n=l.desc,p=l.def,i=l.name,r=l.items,r=void 0===r?[]:r,a=l.title,a=void 0===a?"":a,l=l.type,o=void 0===l?"text":l,[4,s.load(i,p)];case 1:return c=e.sent(),d=Array.isArray(c),l="boolean"==typeof c,u="".concat(v,"-").concat(s.name,"-").concat(i),p={classes:["".concat(v,"-userscript-option"),"mb16"],items:r.map(function(e,t){var n=e.value,r=e.name,a=e.selected,e=__rest(e,["value","name","selected"]);return __assign(__assign({},e),{name:r||"".concat(u,"-item-").concat(t),selected:d&&void 0!==n?c.includes(n):a,value:n})}),description:n,title:a||x(i)},d||l||(p.value=c),"toggle"===o&&(p.selected=!!c),_=__read(t[o](u,p),1),_=_[0],(this.container=_).addEventListener("change",function(e){var r=e.currentTarget,a=e.target;return __awaiter(m,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return g(a)?(t=r instanceof HTMLFieldSetElement?{value:__spreadArray([],__read(r.elements),!1).filter(w).map(function(e){return e.value})}:a,t="toggle"===o&&t instanceof HTMLInputElement?t.checked:t.value,[4,s.save(i,t)]):[2];case 1:return e.sent(),null!=(n=s.container)&&n.dispatchEvent(new CustomEvent("".concat(v,"-success"),{bubbles:!0,detail:{name:i,script:v,value:t}})),[2]}})})}),[2,_]}})})},E=a,r=null==C?void 0:C.default,__extends(n,r),n.prototype.option=function(e,t){return this.options.set(e,new E(this,__assign({name:e},t))),this.render(),this},n.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,a,s=this;return __generator(this,function(e){switch(e.label){case 0:return a=(r=this).name,r=r.options,(t=this.container||(this.container=document.createElement("div"))).classList.add("".concat(v,"-userscript"),"d-flex","fd-column","mb24"),(n=document.createElement("h2")).textContent=x(a),(a=__spreadArray([],__read(r),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()})).length||n.classList.add("mb8"),this.toast||(this.toast=d("".concat(v,"-toast"),"Updated ".concat(v," config"),{classes:["".concat(v,"-userscript-toast"),"wmn3","r0","jc-end"],type:"success"})),t.addEventListener("".concat(v,"-success"),function(){var e=s.toast;e&&_(e,1)}),[4,Promise.all(a)];case 1:return r=e.sent(),i(t),t.append.apply(t,__spreadArray([this.toast,n],__read(r),!1)),r.length||((a=document.createElement("div")).textContent="No configuration options available",t.append(a)),[2,t]}})})},A=n,t.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return(n={parent:document.body},r=["ps-fixed","r0"],t=__spreadArray([],__read(this.scripts),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()}),this.controller||(this.controller=o("".concat(v,"-modal-controller"),"UserScripters",__assign(__assign({},n),{type:"outlined",muted:!0,classes:__spreadArray(__spreadArray([],__read(r),!1),["bar0","t128"],!1)}))),this.modal||(this.modal=c("".concat(v,"-modal"),this.controller,__assign(__assign({},n),{classes:__spreadArray(__spreadArray([],__read(r),!1),["z-modal","".concat(v,"-modal")],!1),contentClasses:["ba","bar-lg","bc-black-075","bg-white","p16","wmn3"],expanded:!1}))),n=this.modal.querySelector(".s-expandable--content"))?[4,Promise.all(t)]:(console.debug("[".concat(v,"] missing modal content element")),[2,this]);case 1:return r=e.sent(),i(n),n.append.apply(n,__spreadArray([],__read(r),!1)),[2,this]}})})},t.prototype.hide=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")&&null!=(e=this.controller)&&e.click(),this},t.prototype.get=function(e){return this.scripts.get(e)},t.prototype.register=function(e){var t=this.storage,t=new A(e,t);return this.scripts.set(e,t),this.render(),t},t.prototype.show=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")||null!=(e=this.controller)&&e.click(),this},t.prototype.unregister=function(e){var t=this.scripts,n=t.get(e);return n&&(t.delete(e),this.render()),n},S=t,L=unsafeWindow.UserScripters||(unsafeWindow.UserScripters={}),L=L.Userscripts||(L.Userscripts={}),C=C.locateStorage(),S=new S(C),L.Configurer||(L.Configurer=S),s(),[4,S.render()]):(console.debug("[".concat(v,"] missing UserScripters storage")),[2]);case 1:return e.sent(),unsafeWindow.dispatchEvent(new CustomEvent("".concat(v,"-load"))),[2]}function t(e){this.storage=e,this.scripts=new Map}function n(e,t){var n=r.call(this,e,t)||this;return n.name=e,n.storage=t,n.options=new Map,n}var r;function a(e,t){this.script=e,this.config=t}})})},{once:!0});