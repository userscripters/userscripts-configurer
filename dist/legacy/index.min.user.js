// ==UserScript==
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     One configurer to setup them all
// @grant           GM_deleteValue
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           unsafeWindow
// @homepage        https://github.com/userscripters/userscripts-configurer#readme
// @match           https://*.stackexchange.com/*
// @match           https://askubuntu.com/*
// @match           https://es.meta.stackoverflow.com/*
// @match           https://es.stackoverflow.com/*
// @match           https://ja.meta.stackoverflow.com/*
// @match           https://ja.stackoverflow.com/*
// @match           https://mathoverflow.net/*
// @match           https://meta.askubuntu.com/*
// @match           https://meta.mathoverflow.net/*
// @match           https://meta.serverfault.com/*
// @match           https://meta.stackoverflow.com/*
// @match           https://meta.superuser.com/*
// @match           https://pt.meta.stackoverflow.com/*
// @match           https://pt.stackoverflow.com/*
// @match           https://ru.meta.stackoverflow.com/*
// @match           https://ru.stackoverflow.com/*
// @match           https://serverfault.com/*
// @match           https://stackapps.com/*
// @match           https://stackoverflow.com/*
// @match           https://superuser.com/*
// @name            Userscripts Configurer
// @namespace       userscripters
// @require         https://github.com/userscripters/storage/raw/master/dist/browser.js
// @run-at          document-start
// @source          git+https://github.com/userscripters/userscripts-configurer.git
// @supportURL      https://github.com/userscripters/userscripts-configurer/issues
// @version         0.1.0
// ==/UserScript==

"use strict";var __extends=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,i,o,d){return new(o=o||Promise)(function(n,t){function a(e){try{s(d.next(e))}catch(e){t(e)}}function r(e){try{s(d.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(a,r)}s((d=d.apply(e,i||[])).next())})},__generator=this&&this.__generator||function(a,r){var s,i,o,d={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;d;)try{if(s=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return d.label++,{value:t[1],done:!1};case 5:d.label++,i=t[1],t=[0];continue;case 7:t=d.ops.pop(),d.trys.pop();continue;default:if(!(o=0<(o=d.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){d=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){d.label=t[1];break}if(6===t[0]&&d.label<o[1]){d.label=o[1],o=t;break}if(o&&d.label<o[2]){d.label=o[2],d.ops.push(t);break}o[2]&&d.ops.pop(),d.trys.pop();continue}t=r.call(a,d)}catch(e){t=[6,e],i=0}finally{s=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,s=n.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(a=s.next()).done;)i.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var a,r=0,s=t.length;r<s;r++)!a&&r in t||((a=a||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))};window.addEventListener("load",function(){var v,s,i,o,d,a,u,n,r,e,t,c,f="userscript-configurer",l=window.Store;function p(e,t){var n=r.call(this,e,t)||this;return n.name=e,n.storage=t,n.options=new Map,n}function _(e){this.storage=e,this.scripts=new Map}l?(v=function(e){return __spreadArray([],__read(e.children),!1).forEach(function(e){return e.remove()})},s=function(e,t){var n=(t=void 0===t?{}:t).classes,n=void 0===n?[]:n,a=t.description,a=void 0===a?"":a,r=t.parent,s=t.placeholder,s=void 0===s?"":s,i=t.title,i=void 0===i?"":i,t=t.value,t=void 0===t?"":t,o=document.createElement("div"),d=((d=o.classList).add.apply(d,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(n),!1)),document.createElement("div")),n=(d.classList.add("d-flex","ps-relative"),document.createElement("input"));return n.classList.add("s-input"),n.id=e,n.type="text",n.placeholder=s,n.value=t,d.append(n),o.append(d),i?((s=document.createElement("div")).classList.add("flex--item"),(t=document.createElement("label")).classList.add("d-block","s-label"),t.htmlFor=e,t.textContent=i,a&&((d=document.createElement("p")).classList.add("s-description","mt2"),d.textContent=a,t.append(d)),s.append(t),o.prepend(s),[o,n,t]):(null!=r&&r.append(o),[o,n])},i=function(e,t){var n=t.items,n=void 0===n?[]:n,t=t.classes,t=void 0===t?[]:t,a=document.createElement("fieldset"),r=((r=a.classList).add.apply(r,__spreadArray(["mt8"],__read(t),!1)),a.id=e,n.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.id,a=e.label,r=e.name,e=e.selected,e=void 0!==e&&e,s=document.createElement("div"),i=s.classList,i=(i.add("d-flex","gs8"),t&&i.add("is-disabled"),document.createElement("div")),o=(i.classList.add("flex--item"),document.createElement("input")),t=(o.classList.add("s-checkbox"),o.disabled=t,o.id=n||r,o.name=r,o.type="checkbox",o.checked=e,document.createElement("label"));return t.classList.add("flex--item","s-label","fw-normal"),t.htmlFor=n||r,t.textContent=a,i.append(o),s.append(i,t),s}));return a.append.apply(a,__spreadArray([],__read(r),!1)),[a]},o=function(e,t){var n,a=t.classes,a=void 0===a?[]:a,r=t.description,r=void 0===r?"":r,s=t.disabled,s=void 0!==s&&s,i=t.items,i=void 0===i?[]:i,o=t.title,o=void 0===o?"":o,t=t.value,t=void 0===t?"":t,d=document.createElement("div"),o=((n=d.classList).add.apply(n,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(a),!1)),o&&((n=document.createElement("label")).classList.add("d-block","s-label"),n.htmlFor=e,n.textContent=o,r&&((a=document.createElement("p")).classList.add("s-description","mt2"),a.textContent=r,n.append(a)),d.append(n)),document.createElement("div")),r=(o.classList.add("flex--item","s-select"),document.createElement("select")),a=(r.id=e,r.disabled=s,i.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.label,a=e.selected,a=void 0!==a&&a,e=e.value,e=void 0===e?"":e,r=document.createElement("option");return r.selected=a,r.value=e,r.textContent=n,r.disabled=t,r}));return r.append.apply(r,__spreadArray([],__read(a),!1)),r.value=t,o.append(r),d.append(o),[d,r]},d=function(e,t,n){var a=(n=void 0===n?{}:n).buttons,a=void 0===a?[]:a,r=n.classes,r=void 0===r?[]:r,s=n.important,s=void 0!==s&&s,i=n.msgClasses,i=void 0===i?[]:i,o=n.parent,n=n.type,n=void 0===n?"none":n,d=document.createElement("div"),c=((c=d.classList).add.apply(c,__spreadArray(["s-toast"],__read(r),!1)),d.setAttribute("aria-hidden","true"),d.setAttribute("role","alertdialog"),d.setAttribute("aria-labelledby","notice-message"),d.id=e,document.createElement("aside")),r=(c.classList.add("s-notice","p8","pl16"),"none"!==n&&c.classList.add("s-notice__".concat(n)),s&&c.classList.add("s-notice__important"),document.createElement("div")),n=((e=r.classList).add.apply(e,__spreadArray(["d-flex","gs16","gsx","ai-center","jc-space-between"],__read(i),!1)),document.createElement("div")),s=(n.classList.add("flex--item"),n.textContent=t,document.createElement("div")),e=(s.classList.add("d-flex"),document.createElement("button"));e.type="button",e.classList.add("s-btn","s-notice--btn"),e.setAttribute("aria-label","Dismiss"),a.push(e);var l,p,u,_,m,v,i=__read((i="iconClearSm",t="M12 3.41 10.59 2 7 5.59 3.41 2 2 3.41 5.59 7 2 10.59 3.41 12 7 8.41 10.59 12 12 10.59 8.41 7 12 3.41z",p=void 0===(p=(l=void 0===l?{}:l).classes)?[]:p,u=void 0===(u=l.width)?14:u,l=void 0===(l=l.height)?u:l,_="http://www.w3.org/2000/svg",m=document.createElementNS(_,"svg"),(v=m.classList).add.apply(v,__spreadArray(["svg-icon",i],__read(p),!1)),m.setAttribute("width",u.toString()),m.setAttribute("height",l.toString()),m.setAttribute("viewBox","0 0 ".concat(u," ").concat(l)),m.setAttribute("aria-hidden","true"),(v=document.createElementNS(_,"path")).setAttribute("d",t),m.append(v),[m,v]),1)[0];return e.append(i),s.append.apply(s,__spreadArray([],__read(a),!1)),r.append(n,s),c.append(r),d.append(c),o&&o.append(d),d},a=function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new ReferenceError("missing toast: ".concat(e));e="true"!==(null==n?void 0:n.getAttribute("aria-hidden"));return n.setAttribute("aria-hidden",(void 0!==t?!t:e).toString()),n},u=function(e,t){var n=a(e,!0);t&&setTimeout(function(){var e,t;t=a(n,!1),e&&setTimeout(function(){return u(t)},1e3*e)},1e3*t)},r=null==l?void 0:l.default,__extends(p,r),p.prototype.option=function(e,t){return this.options.set(e,__assign({name:e},t)),this.render(),this},p.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var c,l,t,p,n,a,r=this;return __generator(this,function(e){switch(e.label){case 0:return c=(n=this).name,n=n.options,(l=this.container||(this.container=document.createElement("div"))).classList.add("".concat(f,"-userscript"),"d-flex","fd-column","mb24"),(t=document.createElement("h2")).classList.add("mb8"),t.textContent=c,p={text:s,select:o,checkbox:i},n=__spreadArray([],__read(n),!1).map(function(e){var e=__read(e,2),o=e[0],d=e[1];return __awaiter(r,void 0,void 0,function(){var t,n,a,r,s,i=this;return __generator(this,function(e){switch(e.label){case 0:return t=d.desc,r=d.def,n=d.items,n=void 0===n?[]:n,a=d.type,a=void 0===a?"text":a,[4,this.load(o,r)];case 1:return r=e.sent(),s=__read(p[a]("".concat(f,"-").concat(c,"-").concat(o),{items:n.map(function(e,t){return __assign(__assign({},e),{name:e.name||"".concat(f,"-").concat(c,"-").concat(o,"-item-").concat(t)})}),description:t,title:o,value:r}),1),(s=s[0]).addEventListener("change",function(e){var a=e.target;return __awaiter(i,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return(t=a,[HTMLInputElement,HTMLSelectElement].some(function(e){return t instanceof e}))?(n=a.value,[4,this.save(o,a.value)]):[2];case 1:return e.sent(),l.dispatchEvent(new CustomEvent("".concat(f,"-success"),{bubbles:!0,detail:{key:o,script:c,value:n}})),[2]}var t})})}),[2,s]}})})}),this.toast||(this.toast=d("".concat(f,"-toast"),"Updated ".concat(c," config"),{classes:["".concat(f,"-userscript-toast"),"wmn3","r0","jc-end"],type:"success"})),l.addEventListener("".concat(f,"-success"),function(){var e=r.toast;e&&u(e,1)}),[4,Promise.all(n)];case 1:return n=e.sent(),v(l),l.append.apply(l,__spreadArray([this.toast,t],__read(n),!1)),n.length||((a=document.createElement("div")).textContent="No configuration options available",l.append(a)),[2,l]}})})},n=p,_.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var u,_,m;return __generator(this,function(e){switch(e.label){case 0:return(_={parent:document.body},m=["ps-fixed","r0"],u=__spreadArray([],__read(this.scripts),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()}),this.controller||(this.controller=(t="".concat(f,"-modal-controller"),n="UserScripters",a=__assign(__assign({},_),{type:"outlined",muted:!0,classes:__spreadArray(__spreadArray([],__read(m),!1),["bar0","t128"],!1)}),r=void 0===(r=(a=void 0===a?{}:a).classes)?[]:r,s=a.title,i=void 0!==(i=a.danger)&&i,o=void 0!==(o=a.loading)&&o,d=void 0!==(d=a.muted)&&d,c=a.parent,l=void 0!==(l=a.primary)&&l,a=void 0===(a=a.type)?"filled":a,(p=document.createElement("button")).id=t,p.textContent=n,(t=p.classList).add.apply(t,__spreadArray(["s-btn","s-btn__".concat(a)],__read(r),!1)),p.setAttribute("role","button"),p.setAttribute("aria-label",s||n),t=p.classList,i&&t.add("s-btn__danger"),d&&t.add("s-btn__muted"),l&&t.add("s-btn__primary"),o&&t.add("is-loading"),s&&(p.title=s),null!=c&&c.append(p),p)),this.modal||(this.modal=(a="".concat(f,"-modal"),r=this.controller,n=__assign(__assign({},_),{classes:__spreadArray(__spreadArray([],__read(m),!1),["z-modal","".concat(f,"-modal")],!1),contentClasses:["ba","bar-lg","bc-black-075","bg-white","p16","wmn3"],expanded:!1}),i=void 0===(i=(n=void 0===n?{}:n).classes)?[]:i,d=void 0===(d=n.content)?[]:d,l=void 0===(l=n.contentClasses)?[]:l,o=n.controllerClasses,t=void 0!==(t=n.expanded)&&t,n=n.parent,s=document.createElement("div"),(c=s.classList).add.apply(c,__spreadArray(["s-expandable"],__read(i),!1)),s.id=a,t&&s.classList.add("is-expanded"),c=document.createElement("div"),(i=c.classList).add.apply(i,__spreadArray(["s-expandable--content"],__read(l),!1)),c.append.apply(c,__spreadArray([],__read(d),!1)),(i=r.dataset).controller="s-expandable-control",o&&(i.sExpandableControlToggleClass=o.join(" ")),r.setAttribute("aria-controls",a),r.setAttribute("aria-expanded",JSON.stringify(t)),s.append(c),null!=n&&n.append(s),s)),_=this.modal.querySelector(".s-expandable--content"))?[4,Promise.all(u)]:(console.debug("[".concat(f,"] missing modal content element")),[2,this]);case 1:return m=e.sent(),v(_),_.append.apply(_,__spreadArray([],__read(m),!1)),[2,this]}var t,n,a,r,s,i,o,d,c,l,p})})},_.prototype.hide=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")&&null!=(e=this.controller)&&e.click(),this},_.prototype.get=function(e){return this.scripts.get(e)},_.prototype.register=function(e){var t=this.storage,t=new n(e,t);return this.scripts.set(e,t),this.render(),t},_.prototype.show=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")||null!=(e=this.controller)&&e.click(),this},_.prototype.unregister=function(e){var t=this.scripts,n=t.get(e);return n&&(t.delete(e),this.render()),n},t=_,e=(e=unsafeWindow.UserScripters||(unsafeWindow.UserScripters={})).Userscripts||(e.Userscripts={}),t=new t(l.locateStorage()),e.Configurer||(e.Configurer=t),l=document.createElement("style"),document.head.append(l),(c=l.sheet)&&[".".concat(f,"-modal {\n                top: 20vh;\n            }"),".".concat(f,"-modal > .s-expandable--content:empty::after {\n                content: 'No userscripts to configure';\n            }"),".".concat(f,"-userscript:last-child {\n                margin-bottom: var(--su2) !important;\n            }"),".".concat(f,"-userscript-toast {\n                top: 20vh;\n                left: unset;\n            }")].forEach(function(e){return c.insertRule(e)}),t.render()):console.debug("[".concat(f,"] missing UserScripters storage"))},{once:!0});