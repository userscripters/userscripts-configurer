// ==UserScript==
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     One configurer to setup them all
// @grant           GM_deleteValue
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           unsafeWindow
// @homepage        https://github.com/userscripters/userscripts-configurer#readme
// @match           https://*.stackexchange.com/*
// @match           https://askubuntu.com/*
// @match           https://es.meta.stackoverflow.com/*
// @match           https://es.stackoverflow.com/*
// @match           https://ja.meta.stackoverflow.com/*
// @match           https://ja.stackoverflow.com/*
// @match           https://mathoverflow.net/*
// @match           https://meta.askubuntu.com/*
// @match           https://meta.mathoverflow.net/*
// @match           https://meta.serverfault.com/*
// @match           https://meta.stackoverflow.com/*
// @match           https://meta.superuser.com/*
// @match           https://pt.meta.stackoverflow.com/*
// @match           https://pt.stackoverflow.com/*
// @match           https://ru.meta.stackoverflow.com/*
// @match           https://ru.stackoverflow.com/*
// @match           https://serverfault.com/*
// @match           https://stackapps.com/*
// @match           https://stackoverflow.com/*
// @match           https://superuser.com/*
// @name            Userscripts Configurer
// @namespace       userscripters
// @require         https://github.com/userscripters/storage/raw/master/dist/browser.js
// @run-at          document-start
// @source          git+https://github.com/userscripters/userscripts-configurer.git
// @supportURL      https://github.com/userscripters/userscripts-configurer/issues
// @version         0.1.0
// ==/UserScript==

"use strict";var __extends=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(a=s.next()).done;)o.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var a,r=0,s=t.length;r<s;r++)!a&&r in t||((a=a||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))};window.addEventListener("load",function(){var m,a,r,d,n,s,e,t,o,v="userscript-configurer",i=window.Store;function c(e,t){var n=s.call(this,e,t)||this;return n.name=e,n.storage=t,n.options=new Map,n}function l(e){this.storage=e,this.scripts=new Map}i?(m=function(e){return __spreadArray([],__read(e.children),!1).forEach(function(e){return e.remove()})},a=function(e,t){var n=(t=void 0===t?{}:t).classes,n=void 0===n?[]:n,a=t.description,a=void 0===a?"":a,r=t.parent,s=t.placeholder,s=void 0===s?"":s,o=t.title,o=void 0===o?"":o,t=t.value,t=void 0===t?"":t,d=document.createElement("div"),i=((i=d.classList).add.apply(i,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(n),!1)),document.createElement("div")),n=(i.classList.add("d-flex","ps-relative"),document.createElement("input"));return n.classList.add("s-input"),n.id=e,n.type="text",n.placeholder=s,n.value=t,i.append(n),d.append(i),o?((s=document.createElement("div")).classList.add("flex--item"),(t=document.createElement("label")).classList.add("d-block","s-label"),t.htmlFor=e,t.textContent=o,a&&((i=document.createElement("p")).classList.add("s-description","mt2"),i.textContent=a,t.append(i)),s.append(t),d.prepend(s),[d,n,t]):(null!=r&&r.append(d),[d,n])},r=function(e,t){var n=t.items,n=void 0===n?[]:n,t=t.classes,t=void 0===t?[]:t,a=document.createElement("fieldset"),r=((r=a.classList).add.apply(r,__spreadArray(["mt8"],__read(t),!1)),a.id=e,n.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.id,a=e.label,r=e.name,e=e.selected,e=void 0!==e&&e,s=document.createElement("div"),o=s.classList,o=(o.add("d-flex","gs8"),t&&o.add("is-disabled"),document.createElement("div")),d=(o.classList.add("flex--item"),document.createElement("input")),t=(d.classList.add("s-checkbox"),d.disabled=t,d.id=n||r,d.name=r,d.type="checkbox",d.checked=e,document.createElement("label"));return t.classList.add("flex--item","s-label","fw-normal"),t.htmlFor=n||r,t.textContent=a,o.append(d),s.append(o,t),s}));return a.append.apply(a,__spreadArray([],__read(r),!1)),[a]},d=function(e,t){var n,a=t.classes,a=void 0===a?[]:a,r=t.description,r=void 0===r?"":r,s=t.disabled,s=void 0!==s&&s,o=t.items,o=void 0===o?[]:o,t=t.title,t=void 0===t?"":t,d=document.createElement("div"),t=((n=d.classList).add.apply(n,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(a),!1)),t&&((n=document.createElement("label")).classList.add("d-block","s-label"),n.htmlFor=e,n.textContent=t,r&&((a=document.createElement("p")).classList.add("s-description","mt2"),a.textContent=r,n.append(a)),d.append(n)),document.createElement("div")),r=(t.classList.add("flex--item","s-select"),document.createElement("select")),a=(r.id=e,r.disabled=s,o.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.label,a=e.selected,a=void 0!==a&&a,e=e.value,e=void 0===e?"":e,r=document.createElement("option");return r.selected=a,r.value=e,r.textContent=n,r.disabled=t,r}));return r.append.apply(r,__spreadArray([],__read(a),!1)),t.append(r),d.append(t),[d,r]},s=null==i?void 0:i.default,__extends(c,s),c.prototype.option=function(e,t){return this.options.set(e,__assign({name:e},t)),this.render(),this},c.prototype.render=function(){var s=this.name,e=this.options,t=this.container||(this.container=document.createElement("div")),n=(t.classList.add("".concat(v,"-userscript"),"d-flex","fd-column","mb24"),document.createElement("h2")),o=(n.classList.add("mb8"),n.textContent=s,{text:a,select:d,checkbox:r}),e=__spreadArray([],__read(e),!1).map(function(e){var e=__read(e,2),n=e[0],e=e[1],t=e.desc,a=e.def,r=e.items,r=void 0===r?[]:r,e=e.type;return __read(o[void 0===e?"text":e]("".concat(v,"-").concat(s,"-").concat(n),{items:r.map(function(e,t){return __assign(__assign({},e),{name:e.name||"".concat(v,"-").concat(s,"-").concat(n,"-item-").concat(t)})}),description:t,title:n,value:a}),1)[0]});return m(t),t.append.apply(t,__spreadArray([n],__read(e),!1)),e.length||((n=document.createElement("div")).textContent="No configuration options available",t.append(n)),t},n=c,l.prototype.render=function(){var e,t,n,a,r,s,o,d,i,c,l={parent:document.body},p=["ps-fixed","r0"],u=__spreadArray([],__read(this.scripts),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()}),_=(this.controller||(this.controller=(d="".concat(v,"-modal-controller"),n="UserScripters",e=__assign(__assign({},l),{type:"outlined",muted:!0,classes:__spreadArray(__spreadArray([],__read(p),!1),["bar0","t128"],!1)}),t=void 0===(t=(e=void 0===e?{}:e).classes)?[]:t,i=e.title,a=void 0!==(a=e.danger)&&a,o=void 0!==(o=e.loading)&&o,r=void 0!==(r=e.muted)&&r,c=e.parent,s=void 0!==(s=e.primary)&&s,e=void 0===(e=e.type)?"filled":e,(_=document.createElement("button")).id=d,_.textContent=n,(d=_.classList).add.apply(d,__spreadArray(["s-btn","s-btn__".concat(e)],__read(t),!1)),_.setAttribute("role","button"),_.setAttribute("aria-label",i||n),d=_.classList,a&&d.add("s-btn__danger"),r&&d.add("s-btn__muted"),s&&d.add("s-btn__primary"),o&&d.add("is-loading"),i&&(_.title=i),null!=c&&c.append(_),_)),this.modal||(this.modal=(e="".concat(v,"-modal"),t=this.controller,n=__assign(__assign({},l),{classes:__spreadArray(__spreadArray([],__read(p),!1),["z-modal","".concat(v,"-modal")],!1),contentClasses:["ba","bar-lg","bc-black-075","bg-white","p16","wmn3"],expanded:!1}),a=void 0===(a=(n=void 0===n?{}:n).classes)?[]:a,r=void 0===(r=n.content)?[]:r,s=void 0===(s=n.contentClasses)?[]:s,o=n.controllerClasses,d=void 0!==(d=n.expanded)&&d,n=n.parent,i=document.createElement("div"),(c=i.classList).add.apply(c,__spreadArray(["s-expandable"],__read(a),!1)),i.id=e,d&&i.classList.add("is-expanded"),c=document.createElement("div"),(a=c.classList).add.apply(a,__spreadArray(["s-expandable--content"],__read(s),!1)),c.append.apply(c,__spreadArray([],__read(r),!1)),(a=t.dataset).controller="s-expandable-control",o&&(a.sExpandableControlToggleClass=o.join(" ")),t.setAttribute("aria-controls",e),t.setAttribute("aria-expanded",JSON.stringify(d)),i.append(c),null!=n&&n.append(i),i)),this.modal.querySelector(".s-expandable--content"));return _?(m(_),_.append.apply(_,__spreadArray([],__read(u),!1))):console.debug("[".concat(v,"] missing modal content element")),this},l.prototype.hide=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")&&null!=(e=this.controller)&&e.click(),this},l.prototype.get=function(e){return this.scripts.get(e)},l.prototype.register=function(e){var t=this.storage,t=new n(e,t);return this.scripts.set(e,t),this.render(),t},l.prototype.show=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")||null!=(e=this.controller)&&e.click(),this},l.prototype.unregister=function(e){var t=this.scripts,n=t.get(e);return n&&(t.delete(e),this.render()),n},t=l,e=(e=unsafeWindow.UserScripters||(unsafeWindow.UserScripters={})).Userscripts||(e.Userscripts={}),t=new t(i.locateStorage()),e.Configurer||(e.Configurer=t),i=document.createElement("style"),document.head.append(i),(o=i.sheet)&&[".".concat(v,"-modal {\n                top: 20vh;\n            }"),".".concat(v,"-modal > .s-expandable--content:empty::after {\n                content: 'No userscripts to configure';\n            }"),".".concat(v,"-userscript:last-child {\n                margin-bottom: var(--su2) !important;\n            }")].forEach(function(e){return o.insertRule(e)}),t.render()):console.debug("[".concat(v,"] missing UserScripters storage"))},{once:!0});