// ==UserScript==
// @author          Oleg Valter <oleg.a.valter@gmail.com>
// @description     One configurer to setup them all
// @grant           GM_deleteValue
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           unsafeWindow
// @homepage        https://github.com/userscripters/userscripts-configurer#readme
// @match           https://*.stackexchange.com/*
// @match           https://askubuntu.com/*
// @match           https://es.meta.stackoverflow.com/*
// @match           https://es.stackoverflow.com/*
// @match           https://ja.meta.stackoverflow.com/*
// @match           https://ja.stackoverflow.com/*
// @match           https://mathoverflow.net/*
// @match           https://meta.askubuntu.com/*
// @match           https://meta.mathoverflow.net/*
// @match           https://meta.serverfault.com/*
// @match           https://meta.stackoverflow.com/*
// @match           https://meta.superuser.com/*
// @match           https://pt.meta.stackoverflow.com/*
// @match           https://pt.stackoverflow.com/*
// @match           https://ru.meta.stackoverflow.com/*
// @match           https://ru.stackoverflow.com/*
// @match           https://serverfault.com/*
// @match           https://stackapps.com/*
// @match           https://stackoverflow.com/*
// @match           https://superuser.com/*
// @name            Userscripts Configurer
// @namespace       userscripters
// @require         https://github.com/userscripters/storage/raw/master/dist/browser.js
// @run-at          document-start
// @source          git+https://github.com/userscripters/userscripts-configurer.git
// @supportURL      https://github.com/userscripters/userscripts-configurer/issues
// @version         0.1.0
// ==/UserScript==

"use strict";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,i,o,d){return new(o=o||Promise)(function(n,t){function r(e){try{s(d.next(e))}catch(e){t(e)}}function a(e){try{s(d.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(r,a)}s((d=d.apply(e,i||[])).next())})},__generator=this&&this.__generator||function(r,a){var s,i,o,d={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;d;)try{if(s=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return d.label++,{value:t[1],done:!1};case 5:d.label++,i=t[1],t=[0];continue;case 7:t=d.ops.pop(),d.trys.pop();continue;default:if(!(o=0<(o=d.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){d=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){d.label=t[1];break}if(6===t[0]&&d.label<o[1]){d.label=o[1],o=t;break}if(o&&d.label<o[2]){d.label=o[2],d.ops.push(t);break}o[2]&&d.ops.pop(),d.trys.pop();continue}t=a.call(r,d)}catch(e){t=[6,e],i=0}finally{s=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__rest=this&&this.__rest||function(e,t){var n={};for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]]);return n},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return i},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};window.addEventListener("load",function(){var v,s,i,o,d,r,c,f,n,a,e,t,l,h="userscript-configurer",u=window.Store;function p(e,t){var n=a.call(this,e,t)||this;return n.name=e,n.storage=t,n.options=new Map,n}function _(e){this.storage=e,this.scripts=new Map}u?(v=function(e){return __spreadArray([],__read(e.children),!1).forEach(function(e){return e.remove()})},s=function(e,t){var n=(t=void 0===t?{}:t).classes,n=void 0===n?[]:n,r=t.description,r=void 0===r?"":r,a=t.parent,s=t.placeholder,s=void 0===s?"":s,i=t.title,i=void 0===i?"":i,t=t.value,t=void 0===t?"":t,o=document.createElement("div"),d=((d=o.classList).add.apply(d,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(n),!1)),document.createElement("div")),n=(d.classList.add("d-flex","ps-relative"),document.createElement("input"));return n.classList.add("s-input"),n.id=e,n.type="text",n.placeholder=s,n.value=t,d.append(n),o.append(d),i?((s=document.createElement("div")).classList.add("flex--item"),(t=document.createElement("label")).classList.add("d-block","s-label"),t.htmlFor=e,t.textContent=i,r&&((d=document.createElement("p")).classList.add("s-description","mt2"),d.textContent=r,t.append(d)),s.append(t),o.prepend(s),[o,n,t]):(null!=a&&a.append(o),[o,n])},i=function(e,t){var n=t.items,n=void 0===n?[]:n,t=t.classes,t=void 0===t?[]:t,r=document.createElement("fieldset"),a=((a=r.classList).add.apply(a,__spreadArray(["mt8"],__read(t),!1)),r.id=e,n.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.id,r=e.label,a=e.name,s=e.selected,s=void 0!==s&&s,e=e.value,e=void 0===e?"":e,i=document.createElement("div"),o=i.classList,o=(o.add("d-flex","gs8"),t&&o.add("is-disabled"),document.createElement("div")),d=(o.classList.add("flex--item"),document.createElement("input")),t=(d.classList.add("s-checkbox"),d.disabled=t,d.id=n||a,d.name=a,d.type="checkbox",d.checked=s,d.value=e,document.createElement("label"));return t.classList.add("flex--item","s-label","fw-normal"),t.htmlFor=n||a,t.textContent=r,o.append(d),i.append(o,t),i}));return r.append.apply(r,__spreadArray([],__read(a),!1)),[r]},o=function(e,t){var n,r=t.classes,r=void 0===r?[]:r,a=t.description,a=void 0===a?"":a,s=t.disabled,s=void 0!==s&&s,i=t.items,i=void 0===i?[]:i,o=t.title,o=void 0===o?"":o,t=t.value,t=void 0===t?"":t,d=document.createElement("div"),o=((n=d.classList).add.apply(n,__spreadArray(["d-flex","gs4","gsy","fd-column"],__read(r),!1)),o&&((n=document.createElement("label")).classList.add("d-block","s-label"),n.htmlFor=e,n.textContent=o,a&&((r=document.createElement("p")).classList.add("s-description","mt2"),r.textContent=a,n.append(r)),d.append(n)),document.createElement("div")),a=(o.classList.add("flex--item","s-select"),document.createElement("select")),r=(a.id=e,a.disabled=s,i.map(function(e){var t=e.disabled,t=void 0!==t&&t,n=e.label,r=e.selected,r=void 0!==r&&r,e=e.value,e=void 0===e?"":e,a=document.createElement("option");return a.selected=r,a.value=e,a.textContent=n,a.disabled=t,a}));return a.append.apply(a,__spreadArray([],__read(r),!1)),a.value=t,o.append(a),d.append(o),[d,a]},d=function(e,t,n){var r=(n=void 0===n?{}:n).buttons,r=void 0===r?[]:r,a=n.classes,a=void 0===a?[]:a,s=n.important,s=void 0!==s&&s,i=n.msgClasses,i=void 0===i?[]:i,o=n.parent,n=n.type,n=void 0===n?"none":n,d=document.createElement("div"),c=((c=d.classList).add.apply(c,__spreadArray(["s-toast"],__read(a),!1)),d.setAttribute("aria-hidden","true"),d.setAttribute("role","alertdialog"),d.setAttribute("aria-labelledby","notice-message"),d.id=e,document.createElement("aside")),a=(c.classList.add("s-notice","p8","pl16"),"none"!==n&&c.classList.add("s-notice__".concat(n)),s&&c.classList.add("s-notice__important"),document.createElement("div")),n=((e=a.classList).add.apply(e,__spreadArray(["d-flex","gs16","gsx","ai-center","jc-space-between"],__read(i),!1)),document.createElement("div")),s=(n.classList.add("flex--item"),n.textContent=t,document.createElement("div")),e=(s.classList.add("d-flex"),document.createElement("button"));e.type="button",e.classList.add("s-btn","s-notice--btn"),e.setAttribute("aria-label","Dismiss"),r.push(e);var l,u,p,_,m,v,i=__read((i="iconClearSm",t="M12 3.41 10.59 2 7 5.59 3.41 2 2 3.41 5.59 7 2 10.59 3.41 12 7 8.41 10.59 12 12 10.59 8.41 7 12 3.41z",u=void 0===(u=(l=void 0===l?{}:l).classes)?[]:u,p=void 0===(p=l.width)?14:p,l=void 0===(l=l.height)?p:l,_="http://www.w3.org/2000/svg",m=document.createElementNS(_,"svg"),(v=m.classList).add.apply(v,__spreadArray(["svg-icon",i],__read(u),!1)),m.setAttribute("width",p.toString()),m.setAttribute("height",l.toString()),m.setAttribute("viewBox","0 0 ".concat(p," ").concat(l)),m.setAttribute("aria-hidden","true"),(v=document.createElementNS(_,"path")).setAttribute("d",t),m.append(v),[m,v]),1)[0];return e.append(i),s.append.apply(s,__spreadArray([],__read(r),!1)),a.append(n,s),c.append(a),d.append(c),o&&o.append(d),d},r=function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new ReferenceError("missing toast: ".concat(e));e="true"!==(null==n?void 0:n.getAttribute("aria-hidden"));return n.setAttribute("aria-hidden",(void 0!==t?!t:e).toString()),n},c=function(e,t){var n=r(e,!0);t&&setTimeout(function(){var e,t;t=r(n,!1),e&&setTimeout(function(){return c(t)},1e3*e)},1e3*t)},f=function(e){return e instanceof HTMLInputElement&&e.checked},a=null==u?void 0:u.default,__extends(p,a),p.prototype.option=function(e,t){return this.options.set(e,__assign({name:e},t)),this.render(),this},p.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var p,_,t,m,n,r,a=this;return __generator(this,function(e){switch(e.label){case 0:return p=(n=this).name,n=n.options,(_=this.container||(this.container=document.createElement("div"))).classList.add("".concat(h,"-userscript"),"d-flex","fd-column","mb24"),(t=document.createElement("h2")).classList.add("mb8"),t.textContent=p,m={text:s,select:o,checkbox:i},n=__spreadArray([],__read(n),!1).map(function(e){var e=__read(e,2),l=e[0],u=e[1];return __awaiter(a,void 0,void 0,function(){var t,n,r,s,i,o,a,d,c=this;return __generator(this,function(e){switch(e.label){case 0:return t=u.desc,a=u.def,n=u.items,n=void 0===n?[]:n,r=u.type,r=void 0===r?"text":r,[4,this.load(l,a)];case 1:return s=e.sent(),i=Array.isArray(s),o="".concat(h,"-").concat(p,"-").concat(l),a={items:n.map(function(e,t){var n=e.value,r=e.name,a=e.selected,e=__rest(e,["value","name","selected"]);return __assign(__assign({},e),{name:r||"".concat(o,"-item-").concat(t),selected:i&&void 0!==n?s.includes(n):a,value:n})}),description:t,title:l},i||(a.value=s),d=__read(m[r](o,a),1),(d=d[0]).addEventListener("change",function(e){var r=e.currentTarget,a=e.target;return __awaiter(c,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return(t=a,[HTMLInputElement,HTMLSelectElement].some(function(e){return t instanceof e}))?(n=(r instanceof HTMLFieldSetElement?{value:__spreadArray([],__read(r.elements),!1).filter(f).map(function(e){return e.value})}:a).value,[4,this.save(l,n)]):[2];case 1:return e.sent(),_.dispatchEvent(new CustomEvent("".concat(h,"-success"),{bubbles:!0,detail:{key:l,script:h,value:n}})),[2]}var t})})}),[2,d]}})})}),this.toast||(this.toast=d("".concat(h,"-toast"),"Updated ".concat(name," config"),{classes:["".concat(h,"-userscript-toast"),"wmn3","r0","jc-end"],type:"success"})),_.addEventListener("".concat(h,"-success"),function(){var e=a.toast;e&&c(e,1)}),[4,Promise.all(n)];case 1:return n=e.sent(),v(_),_.append.apply(_,__spreadArray([this.toast,t],__read(n),!1)),n.length||((r=document.createElement("div")).textContent="No configuration options available",_.append(r)),[2,_]}})})},n=p,_.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var p,_,m;return __generator(this,function(e){switch(e.label){case 0:return(_={parent:document.body},m=["ps-fixed","r0"],p=__spreadArray([],__read(this.scripts),!1).map(function(e){e=__read(e,2);e[0];return e[1].render()}),this.controller||(this.controller=(t="".concat(h,"-modal-controller"),n="UserScripters",r=__assign(__assign({},_),{type:"outlined",muted:!0,classes:__spreadArray(__spreadArray([],__read(m),!1),["bar0","t128"],!1)}),a=void 0===(a=(r=void 0===r?{}:r).classes)?[]:a,s=r.title,i=void 0!==(i=r.danger)&&i,o=void 0!==(o=r.loading)&&o,d=void 0!==(d=r.muted)&&d,c=r.parent,l=void 0!==(l=r.primary)&&l,r=void 0===(r=r.type)?"filled":r,(u=document.createElement("button")).id=t,u.textContent=n,(t=u.classList).add.apply(t,__spreadArray(["s-btn","s-btn__".concat(r)],__read(a),!1)),u.setAttribute("role","button"),u.setAttribute("aria-label",s||n),t=u.classList,i&&t.add("s-btn__danger"),d&&t.add("s-btn__muted"),l&&t.add("s-btn__primary"),o&&t.add("is-loading"),s&&(u.title=s),null!=c&&c.append(u),u)),this.modal||(this.modal=(r="".concat(h,"-modal"),a=this.controller,n=__assign(__assign({},_),{classes:__spreadArray(__spreadArray([],__read(m),!1),["z-modal","".concat(h,"-modal")],!1),contentClasses:["ba","bar-lg","bc-black-075","bg-white","p16","wmn3"],expanded:!1}),i=void 0===(i=(n=void 0===n?{}:n).classes)?[]:i,d=void 0===(d=n.content)?[]:d,l=void 0===(l=n.contentClasses)?[]:l,o=n.controllerClasses,t=void 0!==(t=n.expanded)&&t,n=n.parent,s=document.createElement("div"),(c=s.classList).add.apply(c,__spreadArray(["s-expandable"],__read(i),!1)),s.id=r,t&&s.classList.add("is-expanded"),c=document.createElement("div"),(i=c.classList).add.apply(i,__spreadArray(["s-expandable--content"],__read(l),!1)),c.append.apply(c,__spreadArray([],__read(d),!1)),(i=a.dataset).controller="s-expandable-control",o&&(i.sExpandableControlToggleClass=o.join(" ")),a.setAttribute("aria-controls",r),a.setAttribute("aria-expanded",JSON.stringify(t)),s.append(c),null!=n&&n.append(s),s)),_=this.modal.querySelector(".s-expandable--content"))?[4,Promise.all(p)]:(console.debug("[".concat(h,"] missing modal content element")),[2,this]);case 1:return m=e.sent(),v(_),_.append.apply(_,__spreadArray([],__read(m),!1)),[2,this]}var t,n,r,a,s,i,o,d,c,l,u})})},_.prototype.hide=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")&&null!=(e=this.controller)&&e.click(),this},_.prototype.get=function(e){return this.scripts.get(e)},_.prototype.register=function(e){var t=this.storage,t=new n(e,t);return this.scripts.set(e,t),this.render(),t},_.prototype.show=function(){var e;return null!=(e=this.modal)&&e.classList.contains("is-expanded")||null!=(e=this.controller)&&e.click(),this},_.prototype.unregister=function(e){var t=this.scripts,n=t.get(e);return n&&(t.delete(e),this.render()),n},t=_,e=(e=unsafeWindow.UserScripters||(unsafeWindow.UserScripters={})).Userscripts||(e.Userscripts={}),t=new t(u.locateStorage()),e.Configurer||(e.Configurer=t),u=document.createElement("style"),document.head.append(u),(l=u.sheet)&&[".".concat(h,"-modal {\n                top: 20vh;\n            }"),".".concat(h,"-modal > .s-expandable--content:empty::after {\n                content: 'No userscripts to configure';\n            }"),".".concat(h,"-userscript:last-child {\n                margin-bottom: var(--su2) !important;\n            }"),".".concat(h,"-userscript-toast {\n                top: 20vh;\n                left: unset;\n            }")].forEach(function(e){return l.insertRule(e)}),t.render()):console.debug("[".concat(h,"] missing UserScripters storage"))},{once:!0});